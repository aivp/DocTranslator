import{r as S,f as B,_ as Y}from"./index-DOgXei7T.js";import{v as Z,w as H,y as K,z as Q,A as R,E as _}from"./element-WTle-ZkF.js";import{u as W}from"./usePagination-DRno2DY3.js";import{f as X}from"./index-WjuJrXGL.js";import{l as ee,r as v,Z as te,b as ae,ah as d,ap as ne,m as u,p as oe,P as le,M as m,O as e,U as t,u as c,S as r,q as U,T as re,R as E}from"./vue-DSQ7aDT9.js";import"./vxe-CH38uc_I.js";function ie(h){return S({url:"translates",method:"get",params:h})}function se(h){return S({url:`/translate/${h}`,method:"delete"})}function ce(h){return S({url:"/translates/delete/batch",method:"post",data:h})}const de={class:"app-container"},ue={class:"table-wrapper"},pe={class:"pager-wrapper"},fe=ee({name:"Translate",__name:"index",setup(h){const x="/api",C=v(!1),{paginationData:i,handleCurrentChange:P,handleSizeChange:L}=W(),N=n=>{R.confirm("确认删除当前文档吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{se(n.id).then(()=>{_.success("删除成功"),b()})})},g=v([]),O=n=>{g.value=n.map(p=>p.id),g.value},$=()=>{if(g.value.length===0){_.warning("请选择要删除的文档");return}R.confirm("正在批量删除选中文档，确认删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{ce({ids:g.value}).then(()=>{_.success("删除成功"),b()})})},A=n=>{if(!n.target_filepath){_.warning("文件不存在");return}const p=`${x}/api/admin/translate/download/${n.id}`,k=B();fetch(p,{method:"GET",headers:{Authorization:"Bearer "+k}}).then(o=>{if(!o.ok)throw new Error("Network response was not ok");return o.blob()}).then(o=>{const f=n.origin_filename||`download_${n.id}`,w=window.URL.createObjectURL(o),a=document.createElement("a");a.href=w,a.download=f,document.body.appendChild(a),a.click(),a.remove(),window.URL.revokeObjectURL(w),_.success("下载成功")}).catch(o=>{_.error("下载失败，请稍后重试")})},V=()=>{if(g.value.length===0){_.warning("请选择要下载的文档");return}const n=g.value,p=`${x}/api/admin/translates/download/batch`,k=B();fetch(p,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+k},body:JSON.stringify({ids:n})}).then(o=>{if(!o.ok)throw new Error("Network response was not ok");return o.blob()}).then(o=>{const w=`downloads_${new Date().toISOString().split("T")[0]}.zip`,a=window.URL.createObjectURL(o),s=document.createElement("a");s.href=a,s.download=w,document.body.appendChild(s),s.click(),s.remove(),window.URL.revokeObjectURL(a)}).catch(o=>{_.error("下载失败，请稍后重试")})},D=v([]),T=v(null),y=te({keyword:""}),b=()=>{C.value=!0,ie({page:i.currentPage,limit:i.pageSize,keyword:y.keyword||void 0}).then(({data:n})=>{i.total=n.total,D.value=n.data}).catch(()=>{D.value=[]}).finally(()=>{C.value=!1})},z=()=>{i.currentPage===1?b():i.currentPage=1},M=()=>{var n;(n=T.value)==null||n.resetFields(),z()};return ae([()=>i.currentPage,()=>i.pageSize],b,{immediate:!0}),(n,p)=>{const k=d("el-input"),o=d("el-form-item"),f=d("el-button"),w=d("el-form"),a=d("el-table-column"),s=d("el-tag"),j=d("el-link"),I=d("el-table"),F=d("el-pagination"),q=d("el-card"),G=ne("loading");return u(),oe("div",de,[le((u(),m(q,{shadow:"never"},{default:e(()=>[t(w,{ref_key:"searchFormRef",ref:T,inline:!0,model:y},{default:e(()=>[t(o,{prop:"keyword",label:"",style:{width:"320px","max-width":"100%"}},{default:e(()=>[t(k,{modelValue:y.keyword,"onUpdate:modelValue":p[0]||(p[0]=l=>y.keyword=l),placeholder:"输入查询"},null,8,["modelValue"])]),_:1}),t(o,null,{default:e(()=>[t(f,{type:"primary",icon:c(Z),onClick:z},{default:e(()=>[r("查询")]),_:1},8,["icon"]),t(f,{icon:c(H),onClick:M},{default:e(()=>[r("重置")]),_:1},8,["icon"]),t(f,{icon:c(K),onClick:$},{default:e(()=>[r("删除")]),_:1},8,["icon"]),t(f,{icon:c(Q),onClick:V},{default:e(()=>[r("下载")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"]),U("div",ue,[t(I,{data:D.value,onSelectionChange:O},{default:e(()=>[t(a,{type:"selection",width:"50",align:"left"}),t(a,{prop:"customer_no",width:"80",label:"用户ID",align:"left"}),t(a,{prop:"customer_email",label:"用户邮箱",width:"150",align:"left"}),t(a,{prop:"origin_filename",label:"文档名称",align:"left"}),t(a,{prop:"tenant_name",label:"所属租户",width:"120",align:"left"}),t(a,{prop:"status",label:"任务状态",align:"left",width:"120"},{default:e(l=>[l.row.status=="none"?(u(),m(s,{key:0,type:"primary",effect:"plain"},{default:e(()=>[r("未完成")]),_:1})):l.row.status=="process"?(u(),m(s,{key:1,type:"warning",effect:"plain"},{default:e(()=>[r("翻译中")]),_:1})):l.row.status=="failed"?(u(),m(s,{key:2,type:"danger",effect:"plain"},{default:e(()=>[r("翻译失败")]),_:1})):(u(),m(s,{key:3,type:"success",effect:"plain"},{default:e(()=>[r("已完成")]),_:1}))]),_:1}),t(a,{prop:"start_at",label:"任务开始时间",align:"left"},{default:e(({row:l})=>[r(re(c(X)(l.start_at)),1)]),_:1}),t(a,{prop:"spend_time",label:"完成用时",width:"100",align:"left"}),t(a,{prop:"deleted_flag",label:"用户是否删除",align:"left",width:"120"},{default:e(l=>[l.row.deleted_flag=="Y"?(u(),m(s,{key:0,type:"primary",effect:"plain"},{default:e(()=>[r("是")]),_:1})):l.row.deleted_flag=="N"?(u(),m(s,{key:1,type:"warning",effect:"plain"},{default:e(()=>[r("否")]),_:1})):E("",!0)]),_:1}),t(a,{fixed:"right",label:"操作",width:"100",align:"left"},{default:e(l=>[l.row.target_filepath?(u(),m(j,{key:0,style:{color:"#409eff","margin-right":"12px"},onClick:J=>A(l.row)},{default:e(()=>[r("下载")]),_:2},1032,["onClick"])):E("",!0),t(f,{type:"danger",text:"",size:"small",onClick:J=>N(l.row)},{default:e(()=>[r("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),U("div",pe,[t(F,{background:"",layout:c(i).layout,"page-sizes":c(i).pageSizes,total:c(i).total,"page-size":c(i).pageSize,currentPage:c(i).currentPage,onSizeChange:c(L),onCurrentChange:c(P)},null,8,["layout","page-sizes","total","page-size","currentPage","onSizeChange","onCurrentChange"])])]),_:1})),[[G,C.value]])])}}}),ye=Y(fe,[["__scopeId","data-v-001d1dbd"]]);export{ye as default};
