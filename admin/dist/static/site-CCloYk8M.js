import{e as A,_ as N}from"./index-DOgXei7T.js";import{g as q,d as H}from"./index-B1Vqoxz8.js";import{g as M}from"./index-DI-pG_md.js";import{E as m}from"./element-WTle-ZkF.js";import{l as j,e as T,r as u,d as J,ah as s,ap as R,m as p,p as f,P as z,M as I,O as n,U as t,F as K,a7 as Q,q as D,S as X,aE as Y,aF as Z}from"./vue-DSQ7aDT9.js";import"./vxe-CH38uc_I.js";const $=_=>(Y("data-v-100a301e"),_=_(),Z(),_),ee={class:"app-container"},te={key:0,style:{"margin-bottom":"20px"}},ae={key:1,style:{"margin-bottom":"20px"}},le={class:"form-tip"},oe=$(()=>D("span",null,"必须使用https链接（如：https://example.com/logo.png）",-1)),ne=j({__name:"site",setup(_){const y=A(),v=T(()=>y.isSuperAdmin),U=T(()=>y.tenantId),b=u(!1),w=u([]),c=u(void 0),a=u({admin_site_title:"",site_logo:"",site_name:"",site_title:"",version:"",update_time:null}),S=u(null),V=u(!1),k={version:[{required:!0,message:"请选择版本",trigger:"blur"}],site_title:[{required:!1,message:"请输入站点标题",trigger:"blur"}]},C=()=>a.value.site_logo?a.value.site_logo.startsWith("https://")?[".jpg",".jpeg",".png",".webp",".gif"].some(i=>a.value.site_logo.toLowerCase().endsWith(i))?!0:(m.error("仅支持JPG/PNG/WEBP/GIF格式的图片链接"),!1):(m.error("LOGO必须使用HTTPS协议，请修改后重试"),!1):!0,E=async()=>{var o;try{if(await((o=S.value)==null?void 0:o.validate()),!C())return;V.value=!0;const e={...a.value,update_time:Date.now().toString()};v.value&&c.value&&(e.tenant_id=c.value);const{code:i,message:r}=await H(e);i===200&&(m.success(r||"站点设置保存成功"),await h())}catch(e){console.error("保存失败:",e),m.error("保存失败")}finally{V.value=!1}};J(async()=>{if(b.value=!0,v.value)try{const o=await M({page:1,limit:100});o.data&&o.data.data&&(w.value=o.data.data)}catch(o){console.error("加载租户列表失败:",o)}await h(),b.value=!1});const h=async()=>{try{const o=v.value?c.value:U.value,e=await q(o??void 0);e.data&&(a.value={...e.data,update_time:e.data.update_time??null})}catch(o){console.error("加载配置失败:",o),m.error("加载配置失败")}},L=async()=>{await h()};return(o,e)=>{const i=s("el-alert"),r=s("el-option"),x=s("el-select"),g=s("el-input"),F=s("Warning"),P=s("el-icon"),d=s("el-form-item"),B=s("el-button"),G=s("el-form"),O=s("el-card"),W=R("loading");return p(),f("div",ee,[z((p(),I(O,{shadow:"never","element-loading-text":"加载中..."},{default:n(()=>[v.value?(p(),f("div",te,[t(i,{type:"info",title:"全局配置",description:"请选择租户来查看或编辑其配置。不选择租户则查看/编辑全局默认配置。",closable:!1,"show-icon":""}),t(x,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=l=>c.value=l),placeholder:"选择租户（不选择则为全局配置）",clearable:"",onChange:L,style:{width:"300px","margin-top":"10px"}},{default:n(()=>[t(r,{label:"全局配置",value:void 0}),(p(!0),f(K,null,Q(w.value,l=>(p(),I(r,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])):(p(),f("div",ae,[t(i,{type:"warning",title:"租户配置",description:"此为租户级别配置，仅对本租户生效。如未配置，将使用全局配置。",closable:!1,"show-icon":""})])),t(G,{ref_key:"settingForm",ref:S,model:a.value,rules:k,"label-width":"120px","label-position":"top"},{default:n(()=>[t(d,{label:"站点LOGO地址：",prop:"site_logo"},{default:n(()=>[t(g,{modelValue:a.value.site_logo,"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.site_logo=l),placeholder:"必须输入HTTPS开头的图片URL",clearable:""},null,8,["modelValue"]),D("div",le,[t(P,null,{default:n(()=>[t(F)]),_:1}),oe])]),_:1}),t(d,{label:"用户端站点标题：",prop:"site_title"},{default:n(()=>[t(g,{modelValue:a.value.site_title,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.site_title=l),placeholder:"比如：DocTranslator 开源AI文档翻译"},null,8,["modelValue"])]),_:1}),t(d,{label:"站点名称：",prop:"site_name"},{default:n(()=>[t(g,{modelValue:a.value.site_name,"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.site_name=l),placeholder:"比如：DocTranslator"},null,8,["modelValue"])]),_:1}),t(d,{label:"管理端站点标题：",prop:"admin_site_title"},{default:n(()=>[t(g,{modelValue:a.value.admin_site_title,"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.admin_site_title=l),placeholder:"比如：DocTranslator后台管理中心"},null,8,["modelValue"])]),_:1}),t(d,{label:"系统版本：",prop:"version"},{default:n(()=>[t(x,{modelValue:a.value.version,"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.version=l),placeholder:"请选择版本"},{default:n(()=>[t(r,{value:"community",label:"个人版"}),t(r,{value:"business",label:"企业版"})]),_:1},8,["modelValue"])]),_:1}),t(d,null,{default:n(()=>[t(B,{type:"primary",onClick:E,loading:V.value},{default:n(()=>[X("保存站点设置")]),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])]),_:1},8,["element-loading-text"])),[[W,b.value]])])}}}),ce=N(ne,[["__scopeId","data-v-100a301e"]]);export{ce as default};
