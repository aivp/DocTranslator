import{r as V,d as se,ah as d,ap as le,m as r,p as g,q as s,U as e,O as t,u as m,S as u,P as oe,M as k,T as i,F as $,a7 as q,a2 as G,Q as A,aE as ne,aF as ce}from"./vue-DSQ7aDT9.js";import{A as ie,r as de,B as _e,t as F,C as re,w as ue,E as M,D as H,F as K,G as P,H as Q,I as J}from"./element-C0HbadzC.js";import{r as W,_ as pe}from"./index-Dkx2t_xt.js";import"./vxe-D9jD_6gD.js";function fe(){return W({url:"system/storage",method:"get"})}function R(b){return W({url:"system/storage",method:"delete",data:b})}const X=b=>(ne("data-v-3c1f1154"),b=b(),ce(),b),me={class:"file-manager"},he={class:"header"},ve={class:"tab-label"},ge=X(()=>s("span",null,"上传文档",-1)),be={class:"category-actions"},ye={class:"date-header"},ze={class:"date-text"},ke={class:"date-meta"},xe={class:"file-count"},we={class:"date-size"},Ce={class:"date-actions"},Be={class:"file-table-container"},Ve={class:"file-name-cell"},$e={class:"file-name"},Fe={class:"file-path"},Me={key:1,class:"empty-container"},De={class:"tab-label"},Ie=X(()=>s("span",null,"翻译文档",-1)),Se={class:"category-actions"},Ee={class:"date-header"},Le={class:"date-text"},Te={class:"date-meta"},Oe={class:"file-count"},Ue={class:"date-size"},je={class:"date-actions"},Ne={class:"file-table-container"},qe={class:"file-name-cell"},Ge={class:"file-name"},Ae={class:"file-path"},He={key:1,class:"empty-container"},Ke={__name:"file",setup(b){const x=V(!1),f=V({uploads:{size:0,dates:{}},translate:{size:0,dates:{}}}),D=V("uploads"),z=V({uploads:[],translate:[]}),I=n=>{var a;return((a=f.value[n])==null?void 0:a.dates)&&Object.keys(f.value[n].dates).length>0};se(()=>{w()});const w=async()=>{try{x.value=!0;const n=await fe();if(n.code===200){f.value={uploads:n.data.uploads||{size:0,dates:{}},translate:n.data.translate||{size:0,dates:{}}};for(const a in f.value)Object.keys(f.value[a].dates).length>0&&(z.value[a]=[Object.keys(f.value[a].dates)[0]])}}finally{x.value=!1}},Y=()=>w(),y=n=>{if(n===0)return"0 B";const a=1024,c=["B","KB","MB","GB"],_=Math.floor(Math.log(n)/Math.log(a));return parseFloat((n/Math.pow(a,_)).toFixed(2))+" "+c[_]},S=n=>{const a=n.split(".").pop().toLowerCase();return{pdf:K,doc:P,docx:P,xls:Q,xlsx:Q,ppt:J,pptx:J}[a]||K},E=async n=>{try{await R({type:"file",target:n}),M.success("文件删除成功"),await w()}catch(a){M.error("删除失败: "+a.message)}},C=(n,a)=>{const c={file:`确定要删除文件 "${a.split("/").pop()}" 吗？`,date:`确定要删除日期 "${a.split("/")[1]}" 的所有文件吗？`,category:`确定要删除整个 "${a}" 分类吗？`};ue.confirm(c[n],"警告",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",beforeClose:async(_,v,p)=>{if(_==="confirm"){v.confirmButtonLoading=!0;try{await R({type:n,target:a}),M.success("删除成功"),await w(),p()}catch(B){M.error("删除失败: "+B.message)}finally{v.confirmButtonLoading=!1}}else p()}}).catch(()=>{})};return(n,a)=>{const c=d("el-icon"),_=d("el-button"),v=d("el-tag"),p=d("el-table-column"),B=d("el-tooltip"),L=d("el-popconfirm"),T=d("el-table"),O=d("el-collapse-item"),U=d("el-collapse"),j=d("el-empty"),N=d("el-tab-pane"),Z=d("el-tabs"),ee=d("el-card"),te=le("loading");return r(),g("div",me,[s("div",he,[s("h2",null,[e(c,{class:"header-icon"},{default:t(()=>[e(m(ie))]),_:1}),u(" 文件存储管理 ")]),e(_,{type:"primary",plain:"",onClick:Y,loading:x.value,class:"refresh-btn"},{default:t(()=>[e(c,null,{default:t(()=>[e(m(de))]),_:1}),u("刷新 ")]),_:1},8,["loading"])]),oe((r(),k(ee,{class:"content-card","element-loading-text":"加载中..."},{default:t(()=>[e(Z,{modelValue:D.value,"onUpdate:modelValue":a[4]||(a[4]=l=>D.value=l),class:"main-tabs"},{default:t(()=>[e(N,{name:"uploads"},{label:t(()=>[s("div",ve,[e(c,{class:"tab-icon uploads"},{default:t(()=>[e(m(_e))]),_:1}),ge,e(v,{size:"small",effect:"light",class:"size-tag"},{default:t(()=>{var l;return[u(i(y(((l=f.value.uploads)==null?void 0:l.size)||0)),1)]}),_:1})])]),default:t(()=>[I("uploads")?(r(),g($,{key:0},[s("div",be,[e(_,{type:"danger",size:"medium",onClick:a[0]||(a[0]=l=>C("category","uploads")),class:"delete-category-btn"},{default:t(()=>[e(c,null,{default:t(()=>[e(m(F))]),_:1}),u("删除全部文件 ")]),_:1})]),e(U,{modelValue:z.value.uploads,"onUpdate:modelValue":a[1]||(a[1]=l=>z.value.uploads=l),accordion:"",class:"date-collapse"},{default:t(()=>[(r(!0),g($,null,q(f.value.uploads.dates,(l,h)=>(r(),k(O,{key:h,name:h,class:"date-item"},{title:t(()=>[s("div",ye,[e(c,{size:"20",class:"date-icon"},{default:t(()=>[e(m(H))]),_:1}),s("span",ze,i(h),1),s("div",ke,[s("span",xe,i(l.files.length)+"个文件",1),s("span",we,"共"+i(y(l.size)),1)]),s("div",Ce,[e(_,{type:"danger",size:"small",plain:"",onClick:G(o=>C("date",`uploads/${h}`),["stop"]),class:"delete-date-btn"},{default:t(()=>[e(c,null,{default:t(()=>[e(m(F))]),_:1}),u("删除本日所有文件 ")]),_:2},1032,["onClick"])])])]),default:t(()=>[s("div",Be,[e(T,{data:l.files,border:"",stripe:"","empty-text":"该日期没有文件",class:"file-table"},{default:t(()=>[e(p,{label:"文件名",width:"220"},{default:t(({row:o})=>[s("div",Ve,[e(c,{class:"file-icon"},{default:t(()=>[(r(),k(A(S(o.name))))]),_:2},1024),s("span",$e,i(o.name),1)])]),_:1}),e(p,{label:"大小",width:"120"},{default:t(({row:o})=>[e(v,{size:"small",effect:"plain"},{default:t(()=>[u(i(y(o.size)),1)]),_:2},1024)]),_:1}),e(p,{label:"文件路径","min-width":"300"},{default:t(({row:o})=>[e(B,{content:o.path,placement:"top"},{default:t(()=>[s("span",Fe,i(o.path),1)]),_:2},1032,["content"])]),_:1}),e(p,{label:"操作",width:"120",align:"center"},{default:t(({row:o})=>[e(L,{title:"确定要删除此文件吗？",onConfirm:ae=>E(o.path)},{reference:t(()=>[e(_,{type:"danger",size:"small",round:""},{default:t(()=>[u(" 删除 ")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:2},1032,["data"])])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])],64)):(r(),g("div",Me,[e(j,{description:"暂无上传文件"})]))]),_:1}),e(N,{name:"translate"},{label:t(()=>[s("div",De,[e(c,{class:"tab-icon translate"},{default:t(()=>[e(m(re))]),_:1}),Ie,e(v,{size:"small",effect:"light",class:"size-tag"},{default:t(()=>{var l;return[u(i(y(((l=f.value.translate)==null?void 0:l.size)||0)),1)]}),_:1})])]),default:t(()=>[I("translate")?(r(),g($,{key:0},[s("div",Se,[e(_,{type:"danger",size:"small",onClick:a[2]||(a[2]=l=>C("category","translate")),class:"delete-category-btn"},{default:t(()=>[e(c,null,{default:t(()=>[e(m(F))]),_:1}),u("删除全部文件 ")]),_:1})]),e(U,{modelValue:z.value.translate,"onUpdate:modelValue":a[3]||(a[3]=l=>z.value.translate=l),accordion:"",class:"date-collapse"},{default:t(()=>[(r(!0),g($,null,q(f.value.translate.dates,(l,h)=>(r(),k(O,{key:h,name:h,class:"date-item"},{title:t(()=>[s("div",Ee,[e(c,{size:"20",class:"date-icon"},{default:t(()=>[e(m(H))]),_:1}),s("span",Le,i(h),1),s("div",Te,[s("span",Oe,i(l.files.length)+"个文件",1),s("span",Ue,"共"+i(y(l.size)),1)]),s("div",je,[e(_,{type:"danger",size:"small",onClick:G(o=>C("date",`translate/${h}`),["stop"]),class:"delete-date-btn"},{default:t(()=>[e(c,null,{default:t(()=>[e(m(F))]),_:1}),u("删除本日所有文件 ")]),_:2},1032,["onClick"])])])]),default:t(()=>[s("div",Ne,[e(T,{data:l.files,border:"",stripe:"","empty-text":"该日期没有文件",class:"file-table"},{default:t(()=>[e(p,{label:"文件名",width:"220"},{default:t(({row:o})=>[s("div",qe,[e(c,{class:"file-icon"},{default:t(()=>[(r(),k(A(S(o.name))))]),_:2},1024),s("span",Ge,i(o.name),1)])]),_:1}),e(p,{label:"大小",width:"120"},{default:t(({row:o})=>[e(v,{size:"small",effect:"plain"},{default:t(()=>[u(i(y(o.size)),1)]),_:2},1024)]),_:1}),e(p,{label:"文件路径","min-width":"300"},{default:t(({row:o})=>[e(B,{content:o.path,placement:"top"},{default:t(()=>[s("span",Ae,i(o.path),1)]),_:2},1032,["content"])]),_:1}),e(p,{label:"操作",width:"120",align:"center"},{default:t(({row:o})=>[e(L,{title:"确定要删除此文件吗？",onConfirm:ae=>E(o.path)},{reference:t(()=>[e(_,{type:"danger",size:"small",round:""},{default:t(()=>[u(" 删除 ")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:2},1032,["data"])])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])],64)):(r(),g("div",He,[e(j,{description:"暂无翻译文件"})]))]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["element-loading-text"])),[[te,x.value]])])}}},We=pe(Ke,[["__scopeId","data-v-3c1f1154"]]);export{We as default};
