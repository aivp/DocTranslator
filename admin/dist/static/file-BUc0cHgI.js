import{r as U,d as oe,ah as v,ap as ne,m as r,p as g,q as a,U as e,O as t,u as p,S as _,P as de,M as w,T as i,F as $,a7 as D,a2 as E,Q as J,aE as ie,aF as ce}from"./vue-DSQ7aDT9.js";import{F as _e,w as fe,G as ue,y as x,H as re,I as Q,p as j,A as pe,E as N,J as q,K as R,L as W,M as X}from"./element-WTle-ZkF.js";import{r as Z,_ as me}from"./index-D1ZkKF0s.js";import"./vxe-CH38uc_I.js";function he(){return Z({url:"system/storages",method:"get"})}function Y(V){return Z({url:"system/storages",method:"delete",data:V})}const G=V=>(ie("data-v-2080d229"),V=V(),ce(),V),ve={class:"file-manager"},ge={class:"header"},be={class:"tab-label"},ye=G(()=>a("span",null,"上传文档",-1)),ze={class:"category-actions"},ke={class:"date-header"},$e={class:"date-text"},xe={class:"date-meta"},Ce={class:"file-count"},we={class:"date-size"},Ve={class:"date-actions"},Be={class:"file-table-container"},Fe={class:"file-name-cell"},Me={class:"file-name"},Ie={class:"file-path"},Te={key:1,class:"empty-container"},Le={class:"tab-label"},Oe=G(()=>a("span",null,"翻译文档",-1)),Pe={class:"category-actions"},Se={class:"date-header"},Ue={class:"date-text"},De={class:"date-meta"},Ee={class:"file-count"},je={class:"date-size"},Ne={class:"date-actions"},qe={class:"file-table-container"},Ge={class:"file-name-cell"},Ke={class:"file-name"},Ae={class:"file-path"},He={key:1,class:"empty-container"},Je={class:"tab-label"},Qe=G(()=>a("span",null,"视频文件",-1)),Re={class:"category-actions"},We={class:"date-header"},Xe={class:"date-text"},Ye={class:"date-meta"},Ze={class:"file-count"},et={class:"date-size"},tt={class:"date-actions"},at={class:"file-table-container"},st={class:"file-name-cell"},lt={class:"file-name"},ot={class:"file-path"},nt={key:1,class:"empty-container"},dt={class:"tab-label"},it=G(()=>a("span",null,"图片转PDF",-1)),ct={class:"category-actions"},_t={class:"date-header"},ft={class:"date-text"},ut={class:"date-meta"},rt={class:"file-count"},pt={class:"date-size"},mt={class:"date-actions"},ht={class:"file-table-container"},vt={class:"file-name-cell"},gt={class:"file-name"},bt={class:"file-path"},yt={key:1,class:"empty-container"},zt={__name:"file",setup(V){const I=U(!1),h=U({uploads:{size:0,dates:{}},translate:{size:0,dates:{}},video:{size:0,dates:{}},images_to_pdf:{size:0,dates:{}}}),K=U("uploads"),y=U({uploads:[],translate:[],video:[],images_to_pdf:[]}),T=c=>{var s;return((s=h.value[c])==null?void 0:s.dates)&&Object.keys(h.value[c].dates).length>0};oe(()=>{L()});const L=async()=>{try{I.value=!0;const c=await he();if(c.code===200){h.value={uploads:c.data.uploads||{size:0,dates:{}},translate:c.data.translate||{size:0,dates:{}},video:c.data.video||{size:0,dates:{}},images_to_pdf:c.data.images_to_pdf||{size:0,dates:{}}};for(const s in h.value)Object.keys(h.value[s].dates).length>0&&(y.value[s]=[Object.keys(h.value[s].dates)[0]])}}finally{I.value=!1}},ee=()=>L(),b=c=>{if(c===0)return"0 B";const s=1024,d=["B","KB","MB","GB"],u=Math.floor(Math.log(c)/Math.log(s));return parseFloat((c/Math.pow(s,u)).toFixed(2))+" "+d[u]},H=c=>{const s=c.split(".").pop().toLowerCase();return{pdf:j,doc:R,docx:R,xls:W,xlsx:W,ppt:X,pptx:X}[s]||j},te=(c,s)=>{let d=c.replace(/^.*\/storage\//,"").replace(/^\/app\/storage\//,"").replace(/^storage\//,"");if(s==="images_to_pdf"||d.includes("/images_to_pdf/")){const u=[/uploads\/(tenant_\d+\/user_\d+\/\d{4}-\d{2}-\d{2})\/images_to_pdf\/(.+)$/,/^uploads\/(tenant_\d+)\/(user_\d+)\/(\d{4}-\d{2}-\d{2})\/images_to_pdf\/(.+)$/];for(const f of u){const n=d.match(f);if(n){if(n.length===3)return`images_to_pdf/${n[1]}/${n[2]}`;if(n.length===5)return`images_to_pdf/${n[1]}/${n[2]}/${n[3]}/${n[4]}`}}if(d.includes("uploads/")&&d.includes("/images_to_pdf/")){const f=d.split("/"),n=f.indexOf("uploads");if(n>=0&&f.length>n+4){const z=f[n+1],B=f[n+2],F=f[n+3],C=f.indexOf("images_to_pdf",n);if(C>n+3){const M=f.slice(C+1).join("/");return`images_to_pdf/${z}/${B}/${F}/${M}`}}}}return d},O=async c=>{try{const s=K.value,d=te(c,s);await Y({type:"file",target:d}),N.success("文件删除成功"),await L()}catch(s){N.error("删除失败: "+(s.message||s))}},k=(c,s)=>{const d={file:`确定要删除文件 "${s.split("/").pop()}" 吗？`,date:`确定要删除日期 "${s.split("/")[1]}" 的所有文件吗？`,category:`确定要删除整个 "${s}" 分类吗？`};pe.confirm(d[c],"警告",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",beforeClose:async(u,f,n)=>{if(u==="confirm"){f.confirmButtonLoading=!0;try{await Y({type:c,target:s}),N.success("删除成功"),await L(),n()}catch(z){N.error("删除失败: "+(z.message||z))}finally{f.confirmButtonLoading=!1}}else n()}}).catch(()=>{})};return(c,s)=>{const d=v("el-icon"),u=v("el-button"),f=v("el-tag"),n=v("el-table-column"),z=v("el-tooltip"),B=v("el-popconfirm"),F=v("el-table"),C=v("el-collapse-item"),M=v("el-collapse"),P=v("el-empty"),S=v("el-tab-pane"),ae=v("el-tabs"),se=v("el-card"),le=ne("loading");return r(),g("div",ve,[a("div",ge,[a("h2",null,[e(d,{class:"header-icon"},{default:t(()=>[e(p(_e))]),_:1}),_(" 文件存储管理 ")]),e(u,{type:"primary",plain:"",onClick:ee,loading:I.value,class:"refresh-btn"},{default:t(()=>[e(d,null,{default:t(()=>[e(p(fe))]),_:1}),_("刷新 ")]),_:1},8,["loading"])]),de((r(),w(se,{class:"content-card","element-loading-text":"加载中..."},{default:t(()=>[e(ae,{modelValue:K.value,"onUpdate:modelValue":s[8]||(s[8]=l=>K.value=l),class:"main-tabs"},{default:t(()=>[e(S,{name:"uploads"},{label:t(()=>[a("div",be,[e(d,{class:"tab-icon uploads"},{default:t(()=>[e(p(ue))]),_:1}),ye,e(f,{size:"small",effect:"light",class:"size-tag"},{default:t(()=>{var l;return[_(i(b(((l=h.value.uploads)==null?void 0:l.size)||0)),1)]}),_:1})])]),default:t(()=>[T("uploads")?(r(),g($,{key:0},[a("div",ze,[e(u,{type:"danger",size:"medium",onClick:s[0]||(s[0]=l=>k("category","uploads")),class:"delete-category-btn"},{default:t(()=>[e(d,null,{default:t(()=>[e(p(x))]),_:1}),_("删除全部文件 ")]),_:1})]),e(M,{modelValue:y.value.uploads,"onUpdate:modelValue":s[1]||(s[1]=l=>y.value.uploads=l),accordion:"",class:"date-collapse"},{default:t(()=>[(r(!0),g($,null,D(h.value.uploads.dates,(l,m)=>(r(),w(C,{key:m,name:m,class:"date-item"},{title:t(()=>[a("div",ke,[e(d,{size:"20",class:"date-icon"},{default:t(()=>[e(p(q))]),_:1}),a("span",$e,i(m),1),a("div",xe,[a("span",Ce,i(l.files.length)+"个文件",1),a("span",we,"共"+i(b(l.size)),1)]),a("div",Ve,[e(u,{type:"danger",size:"small",plain:"",onClick:E(o=>k("date",`uploads/${m}`),["stop"]),class:"delete-date-btn"},{default:t(()=>[e(d,null,{default:t(()=>[e(p(x))]),_:1}),_("删除本日所有文件 ")]),_:2},1032,["onClick"])])])]),default:t(()=>[a("div",Be,[e(F,{data:l.files,border:"",stripe:"","empty-text":"该日期没有文件",class:"file-table"},{default:t(()=>[e(n,{label:"文件名",width:"220"},{default:t(({row:o})=>[a("div",Fe,[e(d,{class:"file-icon"},{default:t(()=>[(r(),w(J(H(o.name))))]),_:2},1024),a("span",Me,i(o.name),1)])]),_:1}),e(n,{label:"大小",width:"120"},{default:t(({row:o})=>[e(f,{size:"small",effect:"plain"},{default:t(()=>[_(i(b(o.size)),1)]),_:2},1024)]),_:1}),e(n,{label:"文件路径","min-width":"300"},{default:t(({row:o})=>[e(z,{content:o.path,placement:"top"},{default:t(()=>[a("span",Ie,i(o.path),1)]),_:2},1032,["content"])]),_:1}),e(n,{label:"操作",width:"120",align:"center"},{default:t(({row:o})=>[e(B,{title:"确定要删除此文件吗？",onConfirm:A=>O(o.path)},{reference:t(()=>[e(u,{type:"danger",size:"small",round:""},{default:t(()=>[_(" 删除 ")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:2},1032,["data"])])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])],64)):(r(),g("div",Te,[e(P,{description:"暂无上传文件"})]))]),_:1}),e(S,{name:"translate"},{label:t(()=>[a("div",Le,[e(d,{class:"tab-icon translate"},{default:t(()=>[e(p(re))]),_:1}),Oe,e(f,{size:"small",effect:"light",class:"size-tag"},{default:t(()=>{var l;return[_(i(b(((l=h.value.translate)==null?void 0:l.size)||0)),1)]}),_:1})])]),default:t(()=>[T("translate")?(r(),g($,{key:0},[a("div",Pe,[e(u,{type:"danger",size:"small",onClick:s[2]||(s[2]=l=>k("category","translate")),class:"delete-category-btn"},{default:t(()=>[e(d,null,{default:t(()=>[e(p(x))]),_:1}),_("删除全部文件 ")]),_:1})]),e(M,{modelValue:y.value.translate,"onUpdate:modelValue":s[3]||(s[3]=l=>y.value.translate=l),accordion:"",class:"date-collapse"},{default:t(()=>[(r(!0),g($,null,D(h.value.translate.dates,(l,m)=>(r(),w(C,{key:m,name:m,class:"date-item"},{title:t(()=>[a("div",Se,[e(d,{size:"20",class:"date-icon"},{default:t(()=>[e(p(q))]),_:1}),a("span",Ue,i(m),1),a("div",De,[a("span",Ee,i(l.files.length)+"个文件",1),a("span",je,"共"+i(b(l.size)),1)]),a("div",Ne,[e(u,{type:"danger",size:"small",onClick:E(o=>k("date",`translate/${m}`),["stop"]),class:"delete-date-btn"},{default:t(()=>[e(d,null,{default:t(()=>[e(p(x))]),_:1}),_("删除本日所有文件 ")]),_:2},1032,["onClick"])])])]),default:t(()=>[a("div",qe,[e(F,{data:l.files,border:"",stripe:"","empty-text":"该日期没有文件",class:"file-table"},{default:t(()=>[e(n,{label:"文件名",width:"220"},{default:t(({row:o})=>[a("div",Ge,[e(d,{class:"file-icon"},{default:t(()=>[(r(),w(J(H(o.name))))]),_:2},1024),a("span",Ke,i(o.name),1)])]),_:1}),e(n,{label:"大小",width:"120"},{default:t(({row:o})=>[e(f,{size:"small",effect:"plain"},{default:t(()=>[_(i(b(o.size)),1)]),_:2},1024)]),_:1}),e(n,{label:"文件路径","min-width":"300"},{default:t(({row:o})=>[e(z,{content:o.path,placement:"top"},{default:t(()=>[a("span",Ae,i(o.path),1)]),_:2},1032,["content"])]),_:1}),e(n,{label:"操作",width:"120",align:"center"},{default:t(({row:o})=>[e(B,{title:"确定要删除此文件吗？",onConfirm:A=>O(o.path)},{reference:t(()=>[e(u,{type:"danger",size:"small",round:""},{default:t(()=>[_(" 删除 ")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:2},1032,["data"])])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])],64)):(r(),g("div",He,[e(P,{description:"暂无翻译文件"})]))]),_:1}),e(S,{name:"video"},{label:t(()=>[a("div",Je,[e(d,{class:"tab-icon video"},{default:t(()=>[e(p(Q))]),_:1}),Qe,e(f,{size:"small",effect:"light",class:"size-tag"},{default:t(()=>{var l;return[_(i(b(((l=h.value.video)==null?void 0:l.size)||0)),1)]}),_:1})])]),default:t(()=>[T("video")?(r(),g($,{key:0},[a("div",Re,[e(u,{type:"danger",size:"small",onClick:s[4]||(s[4]=l=>k("category","video")),class:"delete-category-btn"},{default:t(()=>[e(d,null,{default:t(()=>[e(p(x))]),_:1}),_("删除全部文件 ")]),_:1})]),e(M,{modelValue:y.value.video,"onUpdate:modelValue":s[5]||(s[5]=l=>y.value.video=l),accordion:"",class:"date-collapse"},{default:t(()=>[(r(!0),g($,null,D(h.value.video.dates,(l,m)=>(r(),w(C,{key:m,name:m,class:"date-item"},{title:t(()=>[a("div",We,[e(d,{size:"20",class:"date-icon"},{default:t(()=>[e(p(q))]),_:1}),a("span",Xe,i(m),1),a("div",Ye,[a("span",Ze,i(l.files.length)+"个文件",1),a("span",et,"共"+i(b(l.size)),1)]),a("div",tt,[e(u,{type:"danger",size:"small",plain:"",onClick:E(o=>k("date",`video/${m}`),["stop"]),class:"delete-date-btn"},{default:t(()=>[e(d,null,{default:t(()=>[e(p(x))]),_:1}),_("删除本日所有文件 ")]),_:2},1032,["onClick"])])])]),default:t(()=>[a("div",at,[e(F,{data:l.files,border:"",stripe:"","empty-text":"该日期没有文件",class:"file-table"},{default:t(()=>[e(n,{label:"文件名",width:"220"},{default:t(({row:o})=>[a("div",st,[e(d,{class:"file-icon"},{default:t(()=>[e(p(Q))]),_:1}),a("span",lt,i(o.name),1)])]),_:1}),e(n,{label:"大小",width:"120"},{default:t(({row:o})=>[e(f,{size:"small",effect:"plain"},{default:t(()=>[_(i(b(o.size)),1)]),_:2},1024)]),_:1}),e(n,{label:"文件路径","min-width":"300"},{default:t(({row:o})=>[e(z,{content:o.path,placement:"top"},{default:t(()=>[a("span",ot,i(o.path),1)]),_:2},1032,["content"])]),_:1}),e(n,{label:"操作",width:"120",align:"center"},{default:t(({row:o})=>[e(B,{title:"确定要删除此文件吗？",onConfirm:A=>O(o.path)},{reference:t(()=>[e(u,{type:"danger",size:"small",round:""},{default:t(()=>[_(" 删除 ")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:2},1032,["data"])])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])],64)):(r(),g("div",nt,[e(P,{description:"暂无视频文件"})]))]),_:1}),e(S,{name:"images_to_pdf"},{label:t(()=>[a("div",dt,[e(d,{class:"tab-icon images-to-pdf"},{default:t(()=>[e(p(j))]),_:1}),it,e(f,{size:"small",effect:"light",class:"size-tag"},{default:t(()=>{var l;return[_(i(b(((l=h.value.images_to_pdf)==null?void 0:l.size)||0)),1)]}),_:1})])]),default:t(()=>[T("images_to_pdf")?(r(),g($,{key:0},[a("div",ct,[e(u,{type:"danger",size:"small",onClick:s[6]||(s[6]=l=>k("category","images_to_pdf")),class:"delete-category-btn"},{default:t(()=>[e(d,null,{default:t(()=>[e(p(x))]),_:1}),_("删除全部文件 ")]),_:1})]),e(M,{modelValue:y.value.images_to_pdf,"onUpdate:modelValue":s[7]||(s[7]=l=>y.value.images_to_pdf=l),accordion:"",class:"date-collapse"},{default:t(()=>[(r(!0),g($,null,D(h.value.images_to_pdf.dates,(l,m)=>(r(),w(C,{key:m,name:m,class:"date-item"},{title:t(()=>[a("div",_t,[e(d,{size:"20",class:"date-icon"},{default:t(()=>[e(p(q))]),_:1}),a("span",ft,i(m),1),a("div",ut,[a("span",rt,i(l.files.length)+"个文件",1),a("span",pt,"共"+i(b(l.size)),1)]),a("div",mt,[e(u,{type:"danger",size:"small",plain:"",onClick:E(o=>k("date",`images_to_pdf/${m}`),["stop"]),class:"delete-date-btn"},{default:t(()=>[e(d,null,{default:t(()=>[e(p(x))]),_:1}),_("删除本日所有文件 ")]),_:2},1032,["onClick"])])])]),default:t(()=>[a("div",ht,[e(F,{data:l.files,border:"",stripe:"","empty-text":"该日期没有文件",class:"file-table"},{default:t(()=>[e(n,{label:"文件名",width:"220"},{default:t(({row:o})=>[a("div",vt,[e(d,{class:"file-icon"},{default:t(()=>[e(p(j))]),_:1}),a("span",gt,i(o.name),1)])]),_:1}),e(n,{label:"大小",width:"120"},{default:t(({row:o})=>[e(f,{size:"small",effect:"plain"},{default:t(()=>[_(i(b(o.size)),1)]),_:2},1024)]),_:1}),e(n,{label:"文件路径","min-width":"300"},{default:t(({row:o})=>[e(z,{content:o.path,placement:"top"},{default:t(()=>[a("span",bt,i(o.path),1)]),_:2},1032,["content"])]),_:1}),e(n,{label:"操作",width:"120",align:"center"},{default:t(({row:o})=>[e(B,{title:"确定要删除此文件吗？",onConfirm:A=>O(o.path)},{reference:t(()=>[e(u,{type:"danger",size:"small",round:""},{default:t(()=>[_(" 删除 ")]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:2},1032,["data"])])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])],64)):(r(),g("div",yt,[e(P,{description:"暂无图片转PDF文件"})]))]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["element-loading-text"])),[[le,I.value]])])}}},wt=me(zt,[["__scopeId","data-v-2080d229"]]);export{wt as default};
