import{r as S,f as q,_ as J}from"./index-wPdwrGlV.js";import{v as Y,w as Z,y as G,z as H,A as B,E as h}from"./element-WTle-ZkF.js";import{u as K}from"./usePagination-DRno2DY3.js";import{f as Q}from"./index-WjuJrXGL.js";import{l as W,r as k,Z as X,b as ee,ah as c,ap as te,m as d,p as ae,P as ne,M as p,O as e,U as t,u as l,S as o,q as P,T as le,R}from"./vue-DSQ7aDT9.js";import"./vxe-CH38uc_I.js";function oe(f){return S({url:"translates",method:"get",params:f})}function re(f){return S({url:`/translate/${f}`,method:"delete"})}function ie(f){return S({url:"/translates/delete/batch",method:"post",data:f})}const se={class:"app-container"},ce={class:"table-wrapper"},de={class:"pager-wrapper"},ue=W({name:"Translate",__name:"index",setup(f){const x="/api",v=k(!1),{paginationData:r,handleCurrentChange:E,handleSizeChange:N}=K(),U=i=>{B.confirm("确认删除当前文档吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{re(i.id).then(()=>{h.success("删除成功"),y()})})},_=k([]),V=i=>{_.value=i.map(m=>m.id),_.value},A=()=>{if(_.value.length===0){h.warning("请选择要删除的文档");return}B.confirm("正在批量删除选中文档，确认删除？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{ie({ids:_.value}).then(()=>{h.success("删除成功"),y()})})},M=()=>{if(_.value.length===0){h.warning("请选择要下载的文档");return}const i=_.value,m=`${x}/api/admin/translates/download/batch`,C=q();fetch(m,{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+C},body:JSON.stringify({ids:i})}).then(u=>{if(!u.ok)throw new Error("Network response was not ok");return u.blob()}).then(u=>{const D=`downloads_${new Date().toISOString().split("T")[0]}.zip`,n=window.URL.createObjectURL(u),s=document.createElement("a");s.href=n,s.download=D,document.body.appendChild(s),s.click(),s.remove(),window.URL.revokeObjectURL(n)}).catch(u=>{h.error("下载失败，请稍后重试")})},b=k([]),T=k(null),w=X({keyword:""}),y=()=>{v.value=!0,oe({page:r.currentPage,limit:r.pageSize,keyword:w.keyword||void 0}).then(({data:i})=>{r.total=i.total,b.value=i.data}).catch(()=>{b.value=[]}).finally(()=>{v.value=!1})},z=()=>{r.currentPage===1?y():r.currentPage=1},O=()=>{var i;(i=T.value)==null||i.resetFields(),z()};return ee([()=>r.currentPage,()=>r.pageSize],y,{immediate:!0}),(i,m)=>{const C=c("el-input"),u=c("el-form-item"),g=c("el-button"),D=c("el-form"),n=c("el-table-column"),s=c("el-tag"),L=c("el-link"),I=c("el-table"),$=c("el-pagination"),j=c("el-card"),F=te("loading");return d(),ae("div",se,[ne((d(),p(j,{shadow:"never"},{default:e(()=>[t(D,{ref_key:"searchFormRef",ref:T,inline:!0,model:w},{default:e(()=>[t(u,{prop:"keyword",label:"",style:{width:"320px","max-width":"100%"}},{default:e(()=>[t(C,{modelValue:w.keyword,"onUpdate:modelValue":m[0]||(m[0]=a=>w.keyword=a),placeholder:"输入查询"},null,8,["modelValue"])]),_:1}),t(u,null,{default:e(()=>[t(g,{type:"primary",icon:l(Y),onClick:z},{default:e(()=>[o("查询")]),_:1},8,["icon"]),t(g,{icon:l(Z),onClick:O},{default:e(()=>[o("重置")]),_:1},8,["icon"]),t(g,{icon:l(G),onClick:A},{default:e(()=>[o("删除")]),_:1},8,["icon"]),t(g,{icon:l(H),onClick:M},{default:e(()=>[o("下载")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"]),P("div",ce,[t(I,{data:b.value,onSelectionChange:V},{default:e(()=>[t(n,{type:"selection",width:"50",align:"left"}),t(n,{prop:"customer_no",width:"80",label:"用户ID",align:"left"}),t(n,{prop:"customer_email",label:"用户邮箱",width:"150",align:"left"}),t(n,{prop:"origin_filename",label:"文档名称",align:"left"}),t(n,{prop:"tenant_name",label:"所属租户",width:"120",align:"left"}),t(n,{prop:"status",label:"任务状态",align:"left",width:"120"},{default:e(a=>[a.row.status=="none"?(d(),p(s,{key:0,type:"primary",effect:"plain"},{default:e(()=>[o("未完成")]),_:1})):a.row.status=="process"?(d(),p(s,{key:1,type:"warning",effect:"plain"},{default:e(()=>[o("翻译中")]),_:1})):a.row.status=="failed"?(d(),p(s,{key:2,type:"danger",effect:"plain"},{default:e(()=>[o("翻译失败")]),_:1})):(d(),p(s,{key:3,type:"success",effect:"plain"},{default:e(()=>[o("已完成")]),_:1}))]),_:1}),t(n,{prop:"start_at",label:"任务开始时间",align:"left"},{default:e(({row:a})=>[o(le(l(Q)(a.start_at)),1)]),_:1}),t(n,{prop:"spend_time",label:"完成用时",width:"100",align:"left"}),t(n,{prop:"deleted_flag",label:"用户是否删除",align:"left",width:"120"},{default:e(a=>[a.row.deleted_flag=="Y"?(d(),p(s,{key:0,type:"primary",effect:"plain"},{default:e(()=>[o("是")]),_:1})):a.row.deleted_flag=="N"?(d(),p(s,{key:1,type:"warning",effect:"plain"},{default:e(()=>[o("否")]),_:1})):R("",!0)]),_:1}),t(n,{fixed:"right",label:"操作",width:"100",align:"left"},{default:e(a=>[a.row.target_filepath?(d(),p(L,{key:0,style:{color:"#409eff","margin-right":"12px"},href:l(x)+"/api/admin/translate/download/"+a.row.id},{default:e(()=>[o("下载")]),_:2},1032,["href"])):R("",!0),t(g,{type:"danger",text:"",size:"small",onClick:pe=>U(a.row)},{default:e(()=>[o("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),P("div",de,[t($,{background:"",layout:l(r).layout,"page-sizes":l(r).pageSizes,total:l(r).total,"page-size":l(r).pageSize,currentPage:l(r).currentPage,onSizeChange:l(N),onCurrentChange:l(E)},null,8,["layout","page-sizes","total","page-size","currentPage","onSizeChange","onCurrentChange"])])]),_:1})),[[F,v.value]])])}}}),ye=J(ue,[["__scopeId","data-v-d6f93973"]]);export{ye as default};
