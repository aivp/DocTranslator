import{r as x,e as ce,_ as pe}from"./index-DHbBoFFL.js";import{g as me}from"./index-Fy_YmPVJ.js";import{t as U,v as _e,w as fe,x as ve,B as ge,y as he,E as V,A as M}from"./element-WTle-ZkF.js";import{u as ye}from"./usePagination-DRno2DY3.js";import{f as we}from"./index-WjuJrXGL.js";import{l as be,r as f,e as N,Z as O,b as Ce,ah as r,ap as Ve,m as c,p as Z,P as j,M as v,O as a,U as e,u as s,S as p,q as k,T as G,R as S,F as ke,a7 as xe}from"./vue-DSQ7aDT9.js";import"./vxe-CH38uc_I.js";function Ue(d){return x({url:"users",method:"get",params:d})}function Se(d){return x({url:"user",method:"put",data:d})}function ze(d,i){return x({url:`user/${d}`,method:"post",data:i})}function De(d){return x({url:`user/${d}`,method:"delete"})}function Ae(d){return x({url:`user/${d}/reset-password`,method:"post"})}const Te={class:"app-container"},Pe={class:"table-wrapper"},Be={class:"pager-wrapper"},$e={class:"dialog_head"},Re={class:"title"},qe={class:"btn_box"},Fe=be({name:"UserManagement",__name:"index",setup(d){const i=f(!1),{paginationData:u,handleCurrentChange:H,handleSizeChange:J}=ye(),B=ce(),g=N(()=>B.isSuperAdmin),z=N(()=>B.tenantId),D={id:void 0,name:"",email:"",password:"",tenant_id:void 0},h=f(!1),A=f(null),n=f(U(D)),K=O({name:[{required:!0,trigger:"blur",message:"请输入管理员姓名"}],email:[{required:!0,trigger:"blur",message:"请输入邮箱"}],password:[{required:!0,trigger:"blur",message:"请输入密码"}],tenant_id:[{required:!1,message:"请选择租户",trigger:"change"}]}),$=f([]),T=f(!1),R=async()=>{if(g.value){T.value=!0;try{const t=await me({page:1,limit:100});t.code===200&&($.value=t.data.data)}catch(t){console.error("获取租户列表失败:",t)}finally{T.value=!1}}},Q=()=>{var t;(t=A.value)==null||t.validate((o,y)=>{if(!o)return console.error("表单校验不通过",y);!g.value&&z.value&&(n.value.tenant_id=z.value),i.value=!0,(n.value.id?ze(n.value.id,n.value):Se(n.value)).then(()=>{V.success("操作成功"),h.value=!1,C()}).finally(()=>{i.value=!1})})},q=()=>{var t;(t=A.value)==null||t.clearValidate(),n.value=U(D),h.value=!1},W=()=>{n.value=U(D),g.value,z.value,g.value&&R(),h.value=!0},X=t=>{n.value=U({...t,password:"",tenant_id:void 0}),g.value&&R(),h.value=!0},Y=t=>{if(t.id===1){V.error("不能删除超级管理员");return}M.confirm(`确定要删除管理员"${t.name}"吗？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{i.value=!0,De(t.id).then(()=>{V.success("删除成功"),C()}).finally(()=>{i.value=!1})}).catch(()=>{})},ee=t=>{if(t.id===1){V.error("不能重置超级管理员密码");return}M.confirm(`确定要重置管理员"${t.name}"的密码吗？新密码为：ad2025`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{i.value=!0,Ae(t.id).then(o=>{V.success(`密码已重置为：${o.data.new_password}`),C()}).finally(()=>{i.value=!1})}).catch(()=>{})},P=f([]),ae=f(null),b=O({search:""}),C=()=>{i.value=!0,Ue({page:u.currentPage,limit:u.pageSize,search:b.search||void 0}).then(({data:t})=>{u.total=t.total,P.value=t.data}).catch(()=>{P.value=[]}).finally(()=>{i.value=!1})},F=()=>{u.currentPage===1?C():u.currentPage=1},te=()=>{b.search="",F()};return Ce([()=>u.currentPage,()=>u.pageSize],C,{immediate:!0}),(t,o)=>{const y=r("el-input"),m=r("el-form-item"),_=r("el-button"),L=r("el-form"),w=r("el-table-column"),le=r("el-table"),ne=r("el-pagination"),oe=r("el-card"),re=r("Close"),se=r("el-icon"),ie=r("el-option"),ue=r("el-select"),de=r("el-dialog"),E=Ve("loading");return c(),Z("div",Te,[j((c(),v(oe,{shadow:"never"},{default:a(()=>[e(L,{ref_key:"searchFormRef",ref:ae,inline:!0,model:b},{default:a(()=>[e(m,{prop:"search",label:"",style:{width:"320px","max-width":"100%"}},{default:a(()=>[e(y,{modelValue:b.search,"onUpdate:modelValue":o[0]||(o[0]=l=>b.search=l),placeholder:"输入查询"},null,8,["modelValue"])]),_:1}),e(m,null,{default:a(()=>[e(_,{type:"primary",icon:s(_e),onClick:F},{default:a(()=>[p("查询")]),_:1},8,["icon"]),e(_,{icon:s(fe),onClick:te},{default:a(()=>[p("重置")]),_:1},8,["icon"])]),_:1}),e(m,null,{default:a(()=>[e(_,{type:"primary",icon:s(ve),onClick:W},{default:a(()=>[p("新增管理员")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"]),k("div",Pe,[e(le,{data:P.value},{default:a(()=>[e(w,{prop:"id",label:"管理员ID",align:"left",width:"100"}),e(w,{prop:"name",label:"姓名",align:"left"}),e(w,{prop:"email",label:"邮箱",align:"left"}),e(w,{prop:"tenant_name",label:"所属租户",align:"left"}),e(w,{prop:"created_at",label:"创建时间",align:"left"},{default:a(({row:l})=>[p(G(s(we)(l.created_at)),1)]),_:1}),e(w,{fixed:"right",label:"操作",width:"180",align:"left"},{default:a(l=>[e(_,{type:"primary",text:"",size:"small",icon:s(ge),onClick:I=>X(l.row)},{default:a(()=>[p("编辑")]),_:2},1032,["icon","onClick"]),l.row.role!=="super_admin"?(c(),v(_,{key:0,type:"warning",text:"",size:"small",onClick:I=>ee(l.row)},{default:a(()=>[p("重置密码")]),_:2},1032,["onClick"])):S("",!0),l.row.role!=="super_admin"?(c(),v(_,{key:1,type:"danger",text:"",size:"small",icon:s(he),onClick:I=>Y(l.row)},{default:a(()=>[p("删除")]),_:2},1032,["icon","onClick"])):S("",!0)]),_:1})]),_:1},8,["data"])]),k("div",Be,[e(ne,{background:"",layout:s(u).layout,"page-sizes":s(u).pageSizes,total:s(u).total,"page-size":s(u).pageSize,currentPage:s(u).currentPage,onSizeChange:s(J),onCurrentChange:s(H)},null,8,["layout","page-sizes","total","page-size","currentPage","onSizeChange","onCurrentChange"])])]),_:1})),[[E,i.value]]),e(de,{"modal-class":"custom_dialog",modelValue:h.value,"onUpdate:modelValue":o[5]||(o[5]=l=>h.value=l),"show-close":!1},{header:a(()=>[k("div",$e,[k("div",Re,G(n.value.id===void 0?"新增管理员":"编辑管理员信息"),1),e(se,{onClick:q},{default:a(()=>[e(re)]),_:1})])]),default:a(()=>[e(L,{ref_key:"formRef",ref:A,model:n.value,rules:K,"label-width":"150px","label-position":"left"},{default:a(()=>[g.value&&!n.value.id?(c(),v(m,{key:0,prop:"tenant_id",label:"所属租户",rules:[{required:!0,message:"请选择租户",trigger:"change"}]},{default:a(()=>[j((c(),v(ue,{modelValue:n.value.tenant_id,"onUpdate:modelValue":o[1]||(o[1]=l=>n.value.tenant_id=l),placeholder:"请选择租户",style:{width:"100%"}},{default:a(()=>[(c(!0),Z(ke,null,xe($.value,l=>(c(),v(ie,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])),[[E,T.value]])]),_:1})):S("",!0),e(m,{prop:"name",label:"姓名"},{default:a(()=>[e(y,{modelValue:n.value.name,"onUpdate:modelValue":o[2]||(o[2]=l=>n.value.name=l),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),e(m,{prop:"email",label:"邮箱"},{default:a(()=>[e(y,{modelValue:n.value.email,"onUpdate:modelValue":o[3]||(o[3]=l=>n.value.email=l),placeholder:"请输入邮箱"},null,8,["modelValue"])]),_:1}),n.value.id?S("",!0):(c(),v(m,{key:1,prop:"password",label:"密码"},{default:a(()=>[e(y,{type:"password",modelValue:n.value.password,"onUpdate:modelValue":o[4]||(o[4]=l=>n.value.password=l),placeholder:"请输入密码"},null,8,["modelValue"])]),_:1}))]),_:1},8,["model","rules"]),k("div",qe,[e(_,{onClick:q},{default:a(()=>[p("取消")]),_:1}),e(_,{type:"primary",onClick:Q,loading:i.value},{default:a(()=>[p("确认")]),_:1},8,["loading"])])]),_:1},8,["modelValue"])])}}}),je=pe(Fe,[["__scopeId","data-v-7c6359e8"]]);export{je as default};
