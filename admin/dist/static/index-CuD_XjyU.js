import{r as E,_ as Z}from"./index-Dkx2t_xt.js";import{p as P,E as $,s as se,r as ne,q as re}from"./element-C0HbadzC.js";import{u as ue}from"./usePagination-DRno2DY3.js";import{l as G,r as g,Z as H,ah as t,m as b,M as y,O as l,U as e,S as s,T as q,b as de,ap as ie,p as pe,P as ce,u as f,q as x,aE as me,aF as _e}from"./vue-DSQ7aDT9.js";import"./vxe-D9jD_6gD.js";function fe(r,_){return E({url:`customer/status/${r}`,method:"post",data:{status:_}})}function ge(r){return E({url:`customer/${r.id}`,method:"post",data:r})}function ve(r){return E({url:"customers",method:"get",params:r})}function be(r){return E({url:"customer",method:"PUT",data:r})}const we=G({__name:"register",emits:["success"],setup(r,{emit:_}){const u=_,A={email:"",password:"",level:"common",add_storage:0,storage:0},m=g(P(A)),S=g(null),i=g(!1),U=H({email:[{required:!0,message:"请填写邮箱地址",trigger:"blur"}],level:[{required:!0,message:"请填写用户等级"}],password:[{required:!0,message:"请填写密码",trigger:"blur"}]}),n=()=>{var z;(z=S.value)==null||z.validate((p,k)=>{if(!p)return console.error("表单校验不通过",k);i.value=!0,be(m.value).then(()=>{$.success("操作成功"),u("success"),m.value=P(A)}).catch(v=>{console.error("注册失败:",v),$.error("注册失败，请重试")}).finally(()=>{i.value=!1})})};return(z,p)=>{const k=t("el-input"),v=t("el-form-item"),B=t("el-option"),D=t("el-select"),T=t("el-button"),V=t("el-form");return b(),y(V,{model:m.value,ref_key:"userform",ref:S,"label-width":"auto",rules:U},{default:l(()=>[e(v,{prop:"email",label:"邮箱"},{default:l(()=>[e(k,{modelValue:m.value.email,"onUpdate:modelValue":p[0]||(p[0]=c=>m.value.email=c),placeholder:"请输入邮箱",autocomplete:"new-password"},null,8,["modelValue"])]),_:1}),e(v,{prop:"level",label:"用户等级"},{default:l(()=>[e(D,{modelValue:m.value.level,"onUpdate:modelValue":p[1]||(p[1]=c=>m.value.level=c),placeholder:""},{default:l(()=>[e(B,{label:"会员用户",value:"vip"}),e(B,{label:"普通用户",value:"common"})]),_:1},8,["modelValue"])]),_:1}),e(v,{prop:"password",label:"密码"},{default:l(()=>[e(k,{type:"password",modelValue:m.value.password,"onUpdate:modelValue":p[2]||(p[2]=c=>m.value.password=c),placeholder:"请输入",autocomplete:"new-password"},null,8,["modelValue"])]),_:1}),e(v,{label:"",class:"center"},{default:l(()=>[e(T,{type:"primary",size:"large",color:"#055CF9",onClick:p[3]||(p[3]=c=>n()),loading:i.value,disabled:i.value,style:{width:"100%"}},{default:l(()=>[s(q(i.value?"提交中...":"提交"),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["model","rules"])}}}),he=Z(we,[["__scopeId","data-v-2aa8a117"]]),ye=r=>(me("data-v-f22fa383"),r=r(),_e(),r),Ve={class:"app-container"},Ce={class:"table-wrapper"},ke={class:"pager-wrapper"},xe={class:"dialog_head"},Se={class:"title"},Ue=ye(()=>x("span",{class:"ml-2"},"MB",-1)),ze={class:"btn_box"},De=G({name:"ElementPlus",__name:"index",setup(r){const _=g(!1),{paginationData:u,handleCurrentChange:A,handleSizeChange:m}=ue(),S={id:void 0,email:"",password:"",level:"common",add_storage:0,storage:0},i=g(!1),U=g(null),n=g(P(S)),z={email:[{required:!0,trigger:"blur",message:"请输入注册邮箱"}],password:[{min:6,max:16,message:"长度在 6 到 16 个字符",trigger:"blur"}],level:[{required:!0,trigger:"blur",message:"请选择用户等级"}]},p=()=>{var d;(d=U.value)==null||d.validate((o,F)=>{if(!o)return console.error("表单校验不通过",F);_.value=!0,ge(n.value).then(()=>{$.success("操作成功"),i.value=!1,c()}).finally(()=>{_.value=!1})})},k=()=>{var d;(d=U.value)==null||d.clearValidate(),n.value=P(S),i.value=!1},v=(d,o)=>{fe(d,o).then(()=>{$.success("更改状态成功"),c()})},B=d=>{i.value=!0,n.value=Object.assign(P(d),{password:"",add_storage:0,storage:0})},D=g([]),T=g(null),V=H({keyword:""}),c=()=>{_.value=!0,ve({page:u.currentPage,limit:u.pageSize,keyword:V.keyword||void 0}).then(({data:d})=>{u.total=d.total,D.value=d.data}).catch(()=>{D.value=[]}).finally(()=>{_.value=!1})},I=()=>{u.currentPage===1?c():u.currentPage=1},J=()=>{V.keyword="",I()},M=g(!1),K=()=>{M.value=!0},Q=()=>{M.value=!1,c()};return de([()=>u.currentPage,()=>u.pageSize],c,{immediate:!0}),(d,o)=>{const F=t("el-input"),C=t("el-form-item"),w=t("el-button"),O=t("el-form"),h=t("el-table-column"),R=t("el-tag"),W=t("el-table"),X=t("el-pagination"),Y=t("el-card"),ee=t("Close"),le=t("el-icon"),N=t("el-option"),ae=t("el-select"),te=t("el-input-number"),L=t("el-dialog"),oe=ie("loading");return b(),pe("div",Ve,[ce((b(),y(Y,{shadow:"never"},{default:l(()=>[e(O,{ref_key:"searchFormRef",ref:T,inline:!0,model:V},{default:l(()=>[e(C,{prop:"username",label:"",style:{width:"320px","max-width":"100%"}},{default:l(()=>[e(F,{modelValue:V.keyword,"onUpdate:modelValue":o[0]||(o[0]=a=>V.keyword=a),placeholder:"输入查询"},null,8,["modelValue"])]),_:1}),e(C,null,{default:l(()=>[e(w,{type:"primary",icon:f(se),onClick:I},{default:l(()=>[s("查询")]),_:1},8,["icon"]),e(w,{icon:f(ne),onClick:J},{default:l(()=>[s("重置")]),_:1},8,["icon"])]),_:1}),e(C,null,{default:l(()=>[e(w,{type:"primary",icon:f(re),onClick:K},{default:l(()=>[s("新增用户")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"]),x("div",Ce,[e(W,{data:D.value},{default:l(()=>[e(h,{prop:"id",label:"用户编号",align:"left"}),e(h,{prop:"email",label:"注册邮箱",align:"left"}),e(h,{prop:"level",label:"用户等级",align:"left"},{default:l(a=>[a.row.level=="vip"?(b(),y(R,{key:0,type:"primary",effect:"plain"},{default:l(()=>[s("会员用户")]),_:1})):(b(),y(R,{key:1,type:"warning",effect:"plain"},{default:l(()=>[s("普通用户")]),_:1}))]),_:1}),e(h,{prop:"storage",label:"已用存储空间",align:"left"},{default:l(({row:a})=>[s(q((a.storage/(1024*1024)).toFixed(2))+" MB ",1)]),_:1}),e(h,{prop:"storage",label:"总存储空间",align:"left"},{default:l(({row:a})=>[s(q((a.total_storage/(1024*1024)).toFixed(2))+" MB ",1)]),_:1}),e(h,{prop:"status",label:"账户状态",align:"left"},{default:l(a=>[a.row.status=="enabled"?(b(),y(R,{key:0,type:"success",effect:"plain"},{default:l(()=>[s("启用")]),_:1})):(b(),y(R,{key:1,type:"danger",effect:"plain"},{default:l(()=>[s("禁用")]),_:1}))]),_:1}),e(h,{prop:"created_at",label:"注册时间",align:"left"}),e(h,{fixed:"right",label:"操作",width:"100",align:"left"},{default:l(a=>[e(w,{type:"primary",text:"",size:"small",onClick:j=>B(a.row)},{default:l(()=>[s("编辑")]),_:2},1032,["onClick"]),a.row.status=="enabled"?(b(),y(w,{key:0,type:"danger",text:"",size:"small",onClick:j=>v(a.row.id,"disabled")},{default:l(()=>[s("禁用")]),_:2},1032,["onClick"])):(b(),y(w,{key:1,type:"success",text:"",size:"small",onClick:j=>v(a.row.id,"enabled")},{default:l(()=>[s("启用")]),_:2},1032,["onClick"]))]),_:1})]),_:1},8,["data"])]),x("div",ke,[e(X,{background:"",layout:f(u).layout,"page-sizes":f(u).pageSizes,total:f(u).total,"page-size":f(u).pageSize,currentPage:f(u).currentPage,onSizeChange:f(m),onCurrentChange:f(A)},null,8,["layout","page-sizes","total","page-size","currentPage","onSizeChange","onCurrentChange"])])]),_:1})),[[oe,_.value]]),e(L,{"modal-class":"custom_dialog",modelValue:i.value,"onUpdate:modelValue":o[6]||(o[6]=a=>i.value=a),"show-close":!1},{header:l(()=>[x("div",xe,[x("div",Se,q(n.value.id===void 0?"新增用户":"编辑用户信息"),1),e(le,{onClick:k},{default:l(()=>[e(ee)]),_:1})])]),default:l(()=>[e(O,{ref_key:"formRef",ref:U,model:n.value,rules:z,"label-width":"150px","label-position":"left"},{default:l(()=>[e(C,{prop:"email",label:"注册邮箱"},{default:l(()=>[e(F,{modelValue:n.value.email,"onUpdate:modelValue":o[1]||(o[1]=a=>n.value.email=a),placeholder:"请输入注册邮箱"},null,8,["modelValue"])]),_:1}),e(C,{prop:"level",label:"用户等级"},{default:l(()=>[e(ae,{modelValue:n.value.level,"onUpdate:modelValue":o[2]||(o[2]=a=>n.value.level=a),placeholder:""},{default:l(()=>[e(N,{label:"会员用户",value:"vip"}),e(N,{label:"普通用户",value:"common"})]),_:1},8,["modelValue"])]),_:1}),e(C,{prop:"storage",label:"新增存储空间(MB)"},{default:l(()=>[e(te,{style:{width:"80%"},precision:0,modelValue:n.value.add_storage,"onUpdate:modelValue":o[3]||(o[3]=a=>n.value.add_storage=a),step:5,placeholder:"请输入需要添加的存储空间(MB)"},null,8,["modelValue"]),Ue]),_:1}),e(C,{prop:"password",label:"密码"},{default:l(()=>[e(F,{type:"password",modelValue:n.value.password,"onUpdate:modelValue":o[4]||(o[4]=a=>n.value.password=a),placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),x("div",ze,[e(w,{onClick:o[5]||(o[5]=a=>i.value=!1)},{default:l(()=>[s("取消")]),_:1}),e(w,{type:"primary",onClick:p,loading:_.value},{default:l(()=>[s("确认")]),_:1},8,["loading"])])]),_:1},8,["modelValue"]),e(L,{modelValue:M.value,"onUpdate:modelValue":o[7]||(o[7]=a=>M.value=a),center:"",width:"90%","modal-class":"custom_dialog login_dialog","show-close":!1},{header:l(()=>[s(" 添加用户 ")]),default:l(()=>[e(he,{onSuccess:Q})]),_:1},8,["modelValue"])])}}}),Re=Z(De,[["__scopeId","data-v-f22fa383"]]);export{Re as default};
