import{r as E,e as de,_ as K}from"./index-wPdwrGlV.js";import{t as T,E as N,v as ie,w as pe,x as ce}from"./element-WTle-ZkF.js";import{u as me}from"./usePagination-DRno2DY3.js";import{g as _e}from"./index-BZ8yLXHZ.js";import{l as Q,e as J,r as m,Z as W,d as fe,ah as o,ap as X,m as c,M as f,O as l,U as e,P as Y,p as ee,a7 as ve,F as ge,R as be,S as n,T as P,b as we,u as _,q as U,aE as ye,aF as he}from"./vue-DSQ7aDT9.js";import{f as Ve}from"./index-WjuJrXGL.js";import"./vxe-CH38uc_I.js";function Ce(i,v){return E({url:`customer/status/${i}`,method:"post",data:{status:v}})}function ke(i){return E({url:`customer/${i.id}`,method:"post",data:i})}function Se(i){return E({url:"customers",method:"get",params:i})}function xe(i){return E({url:"customer",method:"PUT",data:i})}const Ue=Q({__name:"register",emits:["success"],setup(i,{emit:v}){const p=v,M=de(),C=J(()=>M.isSuperAdmin),D=J(()=>M.tenantId),y={email:"",password:"",level:"vip",add_storage:0,storage:0,tenant_id:void 0},r=m(T(y)),u=m(null),k=m(!1),z=m(!1),R=m([]),B=W({email:[{required:!0,message:"请填写邮箱地址",trigger:"blur"}],level:[{required:!0,message:"请填写用户等级"}],password:[{required:!0,message:"请填写密码",trigger:"blur"}],tenant_id:[{required:C.value,message:"请选择租户",trigger:"change"}]}),I=async()=>{if(C.value){z.value=!0;try{const g=await _e({page:1,limit:100});g.code===200&&(R.value=g.data.data)}catch(g){console.error("获取租户列表失败:",g)}finally{z.value=!1}}};fe(()=>{C.value&&I()});const F=()=>{var g;(g=u.value)==null||g.validate((s,b)=>{if(!s)return console.error("表单校验不通过",b);!C.value&&D.value&&(r.value.tenant_id=D.value),k.value=!0,xe(r.value).then(()=>{N.success("操作成功"),p("success"),r.value=T(y)}).catch(w=>{console.error("注册失败:",w)}).finally(()=>{k.value=!1})})};return(g,s)=>{const b=o("el-input"),w=o("el-form-item"),q=o("el-option"),S=o("el-select"),L=o("el-button"),O=o("el-form"),d=X("loading");return c(),f(O,{model:r.value,ref_key:"userform",ref:u,"label-width":"auto",rules:B},{default:l(()=>[e(w,{prop:"email",label:"邮箱"},{default:l(()=>[e(b,{modelValue:r.value.email,"onUpdate:modelValue":s[0]||(s[0]=a=>r.value.email=a),placeholder:"请输入邮箱",autocomplete:"new-password"},null,8,["modelValue"])]),_:1}),C.value?(c(),f(w,{key:0,prop:"tenant_id",label:"所属租户"},{default:l(()=>[Y((c(),f(S,{modelValue:r.value.tenant_id,"onUpdate:modelValue":s[1]||(s[1]=a=>r.value.tenant_id=a),placeholder:"请选择租户",style:{width:"100%"}},{default:l(()=>[(c(!0),ee(ge,null,ve(R.value,a=>(c(),f(q,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])),[[d,z.value]])]),_:1})):be("",!0),e(w,{prop:"level",label:"用户等级"},{default:l(()=>[e(S,{modelValue:r.value.level,"onUpdate:modelValue":s[2]||(s[2]=a=>r.value.level=a),placeholder:"",disabled:""},{default:l(()=>[e(q,{label:"会员用户",value:"vip"})]),_:1},8,["modelValue"])]),_:1}),e(w,{prop:"password",label:"密码"},{default:l(()=>[e(b,{type:"password",modelValue:r.value.password,"onUpdate:modelValue":s[3]||(s[3]=a=>r.value.password=a),placeholder:"请输入",autocomplete:"new-password"},null,8,["modelValue"])]),_:1}),e(w,{label:"",class:"center"},{default:l(()=>[e(L,{type:"primary",size:"large",color:"#055CF9",onClick:s[4]||(s[4]=a=>F()),loading:k.value,disabled:k.value,style:{width:"100%"}},{default:l(()=>[n(P(k.value?"提交中...":"提交"),1)]),_:1},8,["loading","disabled"])]),_:1})]),_:1},8,["model","rules"])}}}),De=K(Ue,[["__scopeId","data-v-140ad34a"]]),ze=i=>(ye("data-v-1232262f"),i=i(),he(),i),Fe={class:"app-container"},Ae={class:"table-wrapper"},Pe={class:"pager-wrapper"},Te={class:"dialog_head"},Me={class:"title"},Re=ze(()=>U("span",{class:"ml-2"},"MB",-1)),Be={class:"btn_box"},qe=Q({name:"ElementPlus",__name:"index",setup(i){const v=m(!1),{paginationData:p,handleCurrentChange:M,handleSizeChange:C}=me(),D={id:void 0,email:"",password:"",level:"common",add_storage:0,storage:0},y=m(!1),r=m(null),u=m(T(D)),k={email:[{required:!0,trigger:"blur",message:"请输入注册邮箱"}],password:[{min:6,max:16,message:"长度在 6 到 16 个字符",trigger:"blur"}],level:[{required:!0,trigger:"blur",message:"请选择用户等级"}]},z=()=>{var d;(d=r.value)==null||d.validate((a,A)=>{if(!a)return console.error("表单校验不通过",A);v.value=!0,ke(u.value).then(()=>{N.success("操作成功"),y.value=!1,b()}).finally(()=>{v.value=!1})})},R=()=>{var d;(d=r.value)==null||d.clearValidate(),u.value=T(D),y.value=!1},B=(d,a)=>{Ce(d,a).then(()=>{N.success("更改状态成功"),b()})},I=d=>{y.value=!0,u.value=Object.assign(T(d),{password:"",add_storage:0,storage:0})},F=m([]),g=m(null),s=W({keyword:""}),b=()=>{v.value=!0,Se({page:p.currentPage,limit:p.pageSize,keyword:s.keyword||void 0}).then(({data:d})=>{p.total=d.total,F.value=d.data}).catch(()=>{F.value=[]}).finally(()=>{v.value=!1})},w=()=>{p.currentPage===1?b():p.currentPage=1},q=()=>{s.keyword="",w()},S=m(!1),L=()=>{S.value=!0},O=()=>{S.value=!1,b()};return we([()=>p.currentPage,()=>p.pageSize],b,{immediate:!0}),(d,a)=>{const A=o("el-input"),x=o("el-form-item"),V=o("el-button"),j=o("el-form"),h=o("el-table-column"),$=o("el-tag"),le=o("el-table"),ae=o("el-pagination"),te=o("el-card"),oe=o("Close"),se=o("el-icon"),Z=o("el-option"),ne=o("el-select"),re=o("el-input-number"),G=o("el-dialog"),ue=X("loading");return c(),ee("div",Fe,[Y((c(),f(te,{shadow:"never"},{default:l(()=>[e(j,{ref_key:"searchFormRef",ref:g,inline:!0,model:s},{default:l(()=>[e(x,{prop:"username",label:"",style:{width:"320px","max-width":"100%"}},{default:l(()=>[e(A,{modelValue:s.keyword,"onUpdate:modelValue":a[0]||(a[0]=t=>s.keyword=t),placeholder:"输入查询"},null,8,["modelValue"])]),_:1}),e(x,null,{default:l(()=>[e(V,{type:"primary",icon:_(ie),onClick:w},{default:l(()=>[n("查询")]),_:1},8,["icon"]),e(V,{icon:_(pe),onClick:q},{default:l(()=>[n("重置")]),_:1},8,["icon"])]),_:1}),e(x,null,{default:l(()=>[e(V,{type:"primary",icon:_(ce),onClick:L},{default:l(()=>[n("新增用户")]),_:1},8,["icon"])]),_:1})]),_:1},8,["model"]),U("div",Ae,[e(le,{data:F.value},{default:l(()=>[e(h,{prop:"id",label:"用户编号",align:"left"}),e(h,{prop:"email",label:"注册邮箱",align:"left"}),e(h,{prop:"level",label:"用户等级",align:"left"},{default:l(t=>[t.row.level=="vip"?(c(),f($,{key:0,type:"primary",effect:"plain"},{default:l(()=>[n("会员用户")]),_:1})):(c(),f($,{key:1,type:"warning",effect:"plain"},{default:l(()=>[n("普通用户")]),_:1}))]),_:1}),e(h,{prop:"storage",label:"已用存储空间",align:"left"},{default:l(({row:t})=>[n(P((t.storage/(1024*1024)).toFixed(2))+" MB ",1)]),_:1}),e(h,{prop:"storage",label:"总存储空间",align:"left"},{default:l(({row:t})=>[n(P((t.total_storage/(1024*1024)).toFixed(2))+" MB ",1)]),_:1}),e(h,{prop:"status",label:"账户状态",align:"left"},{default:l(t=>[t.row.status=="enabled"?(c(),f($,{key:0,type:"success",effect:"plain"},{default:l(()=>[n("启用")]),_:1})):(c(),f($,{key:1,type:"danger",effect:"plain"},{default:l(()=>[n("禁用")]),_:1}))]),_:1}),e(h,{prop:"tenant_name",label:"所属租户",align:"left",width:"120"}),e(h,{prop:"created_at",label:"注册时间",align:"left"},{default:l(({row:t})=>[n(P(_(Ve)(t.created_at)),1)]),_:1}),e(h,{fixed:"right",label:"操作",width:"100",align:"left"},{default:l(t=>[e(V,{type:"primary",text:"",size:"small",onClick:H=>I(t.row)},{default:l(()=>[n("编辑")]),_:2},1032,["onClick"]),t.row.status=="enabled"?(c(),f(V,{key:0,type:"danger",text:"",size:"small",onClick:H=>B(t.row.id,"disabled")},{default:l(()=>[n("禁用")]),_:2},1032,["onClick"])):(c(),f(V,{key:1,type:"success",text:"",size:"small",onClick:H=>B(t.row.id,"enabled")},{default:l(()=>[n("启用")]),_:2},1032,["onClick"]))]),_:1})]),_:1},8,["data"])]),U("div",Pe,[e(ae,{background:"",layout:_(p).layout,"page-sizes":_(p).pageSizes,total:_(p).total,"page-size":_(p).pageSize,currentPage:_(p).currentPage,onSizeChange:_(C),onCurrentChange:_(M)},null,8,["layout","page-sizes","total","page-size","currentPage","onSizeChange","onCurrentChange"])])]),_:1})),[[ue,v.value]]),e(G,{"modal-class":"custom_dialog",modelValue:y.value,"onUpdate:modelValue":a[6]||(a[6]=t=>y.value=t),"show-close":!1},{header:l(()=>[U("div",Te,[U("div",Me,P(u.value.id===void 0?"新增用户":"编辑用户信息"),1),e(se,{onClick:R},{default:l(()=>[e(oe)]),_:1})])]),default:l(()=>[e(j,{ref_key:"formRef",ref:r,model:u.value,rules:k,"label-width":"150px","label-position":"left"},{default:l(()=>[e(x,{prop:"email",label:"注册邮箱"},{default:l(()=>[e(A,{modelValue:u.value.email,"onUpdate:modelValue":a[1]||(a[1]=t=>u.value.email=t),placeholder:"请输入注册邮箱"},null,8,["modelValue"])]),_:1}),e(x,{prop:"level",label:"用户等级"},{default:l(()=>[e(ne,{modelValue:u.value.level,"onUpdate:modelValue":a[2]||(a[2]=t=>u.value.level=t),placeholder:""},{default:l(()=>[e(Z,{label:"会员用户",value:"vip"}),e(Z,{label:"普通用户",value:"common"})]),_:1},8,["modelValue"])]),_:1}),e(x,{prop:"storage",label:"新增存储空间(MB)"},{default:l(()=>[e(re,{style:{width:"80%"},precision:0,modelValue:u.value.add_storage,"onUpdate:modelValue":a[3]||(a[3]=t=>u.value.add_storage=t),step:5,placeholder:"请输入需要添加的存储空间(MB)"},null,8,["modelValue"]),Re]),_:1}),e(x,{prop:"password",label:"密码"},{default:l(()=>[e(A,{type:"password",modelValue:u.value.password,"onUpdate:modelValue":a[4]||(a[4]=t=>u.value.password=t),placeholder:"请输入"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),U("div",Be,[e(V,{onClick:a[5]||(a[5]=t=>y.value=!1)},{default:l(()=>[n("取消")]),_:1}),e(V,{type:"primary",onClick:z,loading:v.value},{default:l(()=>[n("确认")]),_:1},8,["loading"])])]),_:1},8,["modelValue"]),e(G,{modelValue:S.value,"onUpdate:modelValue":a[7]||(a[7]=t=>S.value=t),center:"",width:"90%","modal-class":"custom_dialog login_dialog","show-close":!1},{header:l(()=>[n(" 添加用户 ")]),default:l(()=>[e(De,{onSuccess:O})]),_:1},8,["modelValue"])])}}}),Ze=K(qe,[["__scopeId","data-v-1232262f"]]);export{Ze as default};
