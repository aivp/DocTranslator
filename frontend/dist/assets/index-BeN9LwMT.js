import{_ as Q,K as X,u as Y,r as P,i as f,o as v,c as D,a as t,k as l,l as _,w as s,n as x,m as y,E as d,a4 as ee,$ as ae,t as A,C,F as le,q as te,D as se,Z as ne,a9 as oe,ah as ie,O as re,ae as de,a1 as ue,z as V}from"./index-D-0-JOeR.js";import{i as ce}from"./tools-yKGRG2S_.js";const me={class:"images-to-pdf-page"},pe={class:"page-container"},fe={class:"page-header"},ve={class:"header-left"},ge={class:"main-content"},_e={class:"left-panel"},he={class:"upload-area"},we={key:0,class:"images-count"},be={key:0,class:"right-panel"},De={class:"card-header"},ye={key:0,class:"images-list"},Fe=["onDragstart","onDragover","onDrop"],ke={class:"image-preview"},ze=["src","alt"],Pe={class:"image-overlay"},Ae={class:"image-index"},Ce={class:"image-info"},Le=["title"],xe={class:"image-size"},Be={class:"success-content"},Me={class:"success-icon"},Ve={class:"success-info"},Ee={class:"download-tip"},Se={class:"success-actions"},Ie={key:1,class:"page-footer"},Te={class:"generate-text"},Ue={__name:"index",setup(Re){const E=X(),S=Y(),u=P(null),n=P([]),g=P(-1),F=P(!1),c=P(""),p=P({pageSizePreset:"A4",fitMode:"fit",margin:0});function I(a){if(a===0)return"0 B";const e=1024,o=["B","KB","MB","GB"],i=Math.floor(Math.log(a)/Math.log(e));return Math.round(a/Math.pow(e,i)*100)/100+" "+o[i]}function T(a,e){if(n.value.length>=50){d.warning("最多只能上传50张图片");return}if(n.value.some(r=>r.name===a.name&&r.size===a.raw.size)){d.warning("该图片已存在，请勿重复添加");return}if(!["image/jpeg","image/jpg","image/png","image/webp","image/gif","image/bmp"].includes(a.raw.type)){d.error("不支持的图片格式");return}const h=50*1024*1024;if(a.raw.size>h){d.error("图片大小不能超过50MB");return}const w=new FileReader;w.onload=r=>{const b={id:Date.now()+Math.random(),file:a.raw,preview:r.target.result,name:a.name,size:a.raw.size};n.value.push(b)},w.readAsDataURL(a.raw)}function U(a,e){const o=n.value.findIndex(i=>i.name===a.name);o!==-1&&n.value.splice(o,1)}function R(a){const e=n.value[a];if(n.value.splice(a,1),u.value&&e){const o=u.value.uploadFiles,i=o.findIndex(h=>h.name===e.name);i!==-1&&u.value.handleRemove(o[i])}}async function N(){if(c.value)try{await V.confirm("清空后将无法下载已生成的PDF文件，确定要继续吗？","确认清空",{confirmButtonText:"确定清空",cancelButtonText:"取消",type:"warning",distinguishCancelAndClose:!0}),c.value="",n.value=[],u.value&&u.value.clearFiles(),d.success("已清空")}catch{}else n.value=[],u.value&&u.value.clearFiles(),d.success("已清空")}function G(a){return!1}function j(a,e){g.value=a,e.dataTransfer.effectAllowed="move"}function $(a,e){e.preventDefault(),e.dataTransfer.dropEffect="move"}function O(a,e){if(e.preventDefault(),g.value===-1||g.value===a)return;const o=n.value[g.value];n.value.splice(g.value,1),n.value.splice(a,0,o),g.value=-1}function J(){g.value=-1}function B(){E.back()}function K(){if(!c.value){d.warning("PDF链接不存在");return}fetch(c.value,{method:"HEAD"}).then(a=>{a.status===404&&(d.error({message:"文件已过期，请重新生成PDF",duration:5e3}),c.value="")}).catch(()=>{});try{const a=document.createElement("a");a.href=c.value,a.download=`合并图片_${Date.now()}.pdf`,a.target="_blank",document.body.appendChild(a),a.click(),document.body.removeChild(a)}catch(a){console.error("下载PDF失败:",a),d.error("下载失败，请重试")}}async function q(){if(c.value)try{await V.confirm("继续合并将清空当前已生成的PDF文件，确定要继续吗？","确认继续合并",{confirmButtonText:"确定继续",cancelButtonText:"取消",type:"warning",distinguishCancelAndClose:!0}),c.value="",n.value=[],u.value&&u.value.clearFiles(),d.success("已清空，可以继续上传图片")}catch{}else c.value="",n.value=[],u.value&&u.value.clearFiles()}async function H(){if(n.value.length===0){d.warning("请先上传图片");return}F.value=!0;try{const a=new FormData;n.value.forEach(i=>{a.append("files",i.file)});const e={page_size_preset:p.value.pageSizePreset,page_size:null,fit_mode:p.value.fitMode,margin:p.value.margin,image_order:n.value.map((i,h)=>h)};a.append("data",JSON.stringify(e));const o=await ce(a);if(o.code===200){const i=o.data.pdf_url;i?(c.value=i,d.success("PDF生成成功！请点击下载按钮下载文件")):d.error("生成成功但未获取到下载链接")}else d.error(o.message||"生成PDF失败")}catch(a){console.error("生成PDF失败:",a),d.error("生成PDF失败，请重试")}finally{F.value=!1}}return(a,e)=>{const o=f("el-button"),i=f("el-icon"),h=f("el-upload"),w=f("el-card"),r=f("el-option"),b=f("el-option-group"),M=f("el-select"),L=f("el-form-item"),W=f("el-input-number"),Z=f("el-form");return v(),D("div",me,[t("div",pe,[t("div",fe,[t("div",ve,[l(o,{icon:_(ee),circle:"",onClick:B},null,8,["icon"]),e[3]||(e[3]=t("h2",null,"图片合并PDF",-1))])]),t("div",ge,[t("div",_e,[l(w,{class:"upload-card"},{header:s(()=>e[4]||(e[4]=[t("div",{class:"card-header"},[t("span",null,"上传图片")],-1)])),default:s(()=>[l(h,{ref_key:"uploadRef",ref:u,class:"images-uploader",drag:"",action:a.uploadUrl,"auto-upload":!1,limit:50,multiple:"","on-change":T,"on-remove":U,"before-upload":G,accept:"image/jpeg,image/jpg,image/png,image/webp,image/gif,image/bmp",headers:{Authorization:"Bearer "+_(S).token}},{default:s(()=>[t("div",he,[l(i,{size:64,color:"#409EFF"},{default:s(()=>[l(_(ae))]),_:1}),e[5]||(e[5]=t("div",{class:"upload-text"},[t("p",{class:"upload-title"},"点击或拖拽图片到此处上传"),t("p",{class:"upload-tips"},"支持 JPG、PNG、WEBP、GIF、BMP 格式，最多50张")],-1))])]),_:1},8,["action","headers"]),n.value.length>0?(v(),D("div",we," 已上传 "+A(n.value.length)+" 张图片 ",1)):y("",!0)]),_:1}),n.value.length>0?(v(),x(w,{key:0,class:"settings-card"},{header:s(()=>e[6]||(e[6]=[t("div",{class:"card-header"},[t("span",null,"PDF设置")],-1)])),default:s(()=>[l(Z,{model:p.value,"label-width":"120px","label-position":"left"},{default:s(()=>[l(L,{label:"页面尺寸"},{default:s(()=>[l(M,{modelValue:p.value.pageSizePreset,"onUpdate:modelValue":e[0]||(e[0]=m=>p.value.pageSizePreset=m),placeholder:"请选择页面尺寸",style:{width:"100%"}},{default:s(()=>[l(b,{label:"A4"},{default:s(()=>[l(r,{label:"A4 竖版 (210mm × 297mm)",value:"A4"}),l(r,{label:"A4 横版 (297mm × 210mm)",value:"A4-Landscape"})]),_:1}),l(b,{label:"A3"},{default:s(()=>[l(r,{label:"A3 竖版 (297mm × 420mm)",value:"A3"}),l(r,{label:"A3 横版 (420mm × 297mm)",value:"A3-Landscape"})]),_:1}),l(b,{label:"A5"},{default:s(()=>[l(r,{label:"A5 竖版 (148mm × 210mm)",value:"A5"}),l(r,{label:"A5 横版 (210mm × 148mm)",value:"A5-Landscape"})]),_:1}),l(b,{label:"Letter"},{default:s(()=>[l(r,{label:"Letter 竖版 (8.5英寸 × 11英寸)",value:"Letter"}),l(r,{label:"Letter 横版 (11英寸 × 8.5英寸)",value:"Letter-Landscape"})]),_:1}),l(b,{label:"Legal"},{default:s(()=>[l(r,{label:"Legal 竖版 (8.5英寸 × 14英寸)",value:"Legal"}),l(r,{label:"Legal 横版 (14英寸 × 8.5英寸)",value:"Legal-Landscape"})]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(L,{label:"适应模式"},{default:s(()=>[l(M,{modelValue:p.value.fitMode,"onUpdate:modelValue":e[1]||(e[1]=m=>p.value.fitMode=m),placeholder:"请选择适应模式",style:{width:"100%"}},{default:s(()=>[l(r,{label:"适应（保持比例，适应页面）",value:"fit"}),l(r,{label:"拉伸（填满页面，不保持比例）",value:"stretch"}),l(r,{label:"居中（保持原始尺寸，居中显示）",value:"center"})]),_:1},8,["modelValue"])]),_:1}),l(L,{label:"边距"},{default:s(()=>[l(W,{modelValue:p.value.margin,"onUpdate:modelValue":e[2]||(e[2]=m=>p.value.margin=m),min:0,max:100,step:5,placeholder:"边距",style:{width:"100%"}},null,8,["modelValue"]),e[7]||(e[7]=t("div",{class:"margin-tips"},'单位：点（72 DPI），仅在"适应"模式下生效',-1))]),_:1,__:[7]})]),_:1},8,["model"])]),_:1})):y("",!0)]),n.value.length>0?(v(),D("div",be,[l(w,{class:"images-card"},{header:s(()=>[t("div",De,[e[9]||(e[9]=t("span",null,"图片列表（可拖拽调整顺序）",-1)),l(o,{type:"danger",size:"small",onClick:N},{default:s(()=>e[8]||(e[8]=[C("清空全部",-1)])),_:1,__:[8]})])]),default:s(()=>[n.value.length>0?(v(),D("div",ye,[(v(!0),D(le,null,te(n.value,(m,k)=>(v(),D("div",{key:m.id,class:se(["image-item",{dragging:g.value===k}]),draggable:"true",onDragstart:z=>j(k,z),onDragover:ne(z=>$(k,z),["prevent"]),onDrop:z=>O(k,z),onDragend:J},[t("div",ke,[t("img",{src:m.preview,alt:m.name},null,8,ze),t("div",Pe,[t("div",Ae,A(k+1),1),l(o,{type:"danger",icon:_(oe),circle:"",size:"small",onClick:z=>R(k)},null,8,["icon","onClick"])])]),t("div",Ce,[t("div",{class:"image-name",title:m.name},A(m.name),9,Le),t("div",xe,A(I(m.size)),1)])],42,Fe))),128))])):y("",!0)]),_:1})])):y("",!0)]),c.value?(v(),x(w,{key:0,class:"success-card"},{default:s(()=>[t("div",Be,[t("div",Me,[l(i,{size:48,color:"#67C23A"},{default:s(()=>[l(_(ie))]),_:1})]),t("div",Ve,[e[11]||(e[11]=t("h3",null,"PDF生成成功！",-1)),t("p",null,"已成功合并 "+A(n.value.length)+" 张图片为PDF文件",1),t("div",Ee,[l(i,{class:"tip-icon"},{default:s(()=>[l(_(re))]),_:1}),e[10]||(e[10]=t("span",{class:"tip-text"},"请尽快下载，页面关闭后将清理生成的文件",-1))])]),t("div",Se,[l(o,{type:"primary",icon:_(de),onClick:K,size:"large",class:"download-btn"},{default:s(()=>e[12]||(e[12]=[C(" 下载PDF ",-1)])),_:1,__:[12]},8,["icon"]),l(o,{onClick:q,size:"large"},{default:s(()=>e[13]||(e[13]=[C("继续合并",-1)])),_:1,__:[13]})])])]),_:1})):y("",!0),n.value.length>0&&!c.value?(v(),D("div",Ie,[l(o,{onClick:B,size:"large"},{default:s(()=>e[14]||(e[14]=[C("取消",-1)])),_:1,__:[14]}),l(o,{type:"primary",onClick:H,loading:F.value,disabled:n.value.length===0||F.value,size:"large",class:"generate-btn"},{default:s(()=>[F.value?y("",!0):(v(),x(i,{key:0,class:"generate-icon"},{default:s(()=>[l(_(ue))]),_:1})),t("span",Te,A(F.value?"生成中...":`生成PDF（${n.value.length}张）`),1)]),_:1},8,["loading","disabled"])])):y("",!0)])])}}},je=Q(Ue,[["__scopeId","data-v-a92b574a"]]);export{je as default};
