import{_ as X,z as Y,u as H,r as y,e as ee,i as w,o as g,c as v,a,k as t,l as m,w as d,m as B,t as z,n as j,F as x,q as I,E as p,T as ae,x as L,U as le,Q as se,V as te,y as oe,W as re,X as ne,Y as ue,Z as ie}from"./index-CAnwEIGi.js";import{u as ce,t as de}from"./tools-t5wMzLZS.js";const ge={class:"image-translate-page"},pe={class:"page-container"},ve={class:"page-header"},fe={class:"header-left"},_e={class:"header-right"},me={class:"page-content"},he={key:0,class:"upload-section"},we={class:"upload-area"},Be={class:"upload-icon-wrapper"},be={key:1,class:"main-content"},ye={class:"preview-section"},ke={class:"section-header"},ze={class:"header-left"},Le={class:"image-count"},Te={class:"header-right"},Se={class:"preview-grid"},xe={class:"preview-image-wrapper"},Ie=["src"],Ce={key:0,class:"preview-overlay"},Pe={key:1,class:"preview-overlay success"},Ue={key:2,class:"preview-overlay error"},Ve={class:"preview-actions-overlay"},Fe={class:"preview-info"},Me=["title"],Re={class:"preview-size"},Ee={class:"settings-section"},je={key:2,class:"error-section"},Ne={key:0,class:"page-footer"},N="image/jpeg,image/jpg,image/png,image/webp,image/gif",$="/api/tools/image-upload",$e={__name:"index",setup(Ae){const T=Y(),C=H(),A=y(null),D=y(null),r=y([]),i=y({sourceLanguage:"",targetLanguage:"zh"}),h=y(!1),k=y(""),P=[{label:"简体中文",value:"zh",canBeSource:!0,canBeTarget:!0},{label:"英文",value:"en",canBeSource:!0,canBeTarget:!0},{label:"韩语",value:"ko",canBeSource:!0,canBeTarget:!0},{label:"日语",value:"ja",canBeSource:!0,canBeTarget:!0},{label:"俄语",value:"ru",canBeSource:!0,canBeTarget:!0},{label:"西班牙语",value:"es",canBeSource:!0,canBeTarget:!0},{label:"法语",value:"fr",canBeSource:!0,canBeTarget:!0},{label:"葡萄牙语",value:"pt",canBeSource:!0,canBeTarget:!0},{label:"意大利语",value:"it",canBeSource:!0,canBeTarget:!0},{label:"德语",value:"de",canBeSource:!0,canBeTarget:!0}],G=[{label:"越南语",value:"vi",canBeSource:!1,canBeTarget:!0},{label:"马来语",value:"ms",canBeSource:!1,canBeTarget:!0},{label:"泰语",value:"th",canBeSource:!1,canBeTarget:!0},{label:"印尼语",value:"id",canBeSource:!1,canBeTarget:!0},{label:"阿拉伯语",value:"ar",canBeSource:!1,canBeTarget:!0}],q=[...P,...G],O=ee(()=>r.value.some(o=>o.uploading));function Z(o){if(o===0)return"0 B";const e=1024,n=["B","KB","MB","GB"],f=Math.floor(Math.log(o)/Math.log(e));return Math.round(o/Math.pow(e,f)*100)/100+" "+n[f]}function U(o,e){if(r.value.length>=10){p.warning("最多只能上传10张图片");return}if(r.value.some(c=>c.name===o.name&&c.size===o.raw.size)){p.warning("该图片已存在，请勿重复添加");return}if(!["image/jpeg","image/jpg","image/png","image/webp","image/gif"].includes(o.raw.type)){p.error("不支持的图片格式");return}const b=10*1024*1024;if(o.raw.size>b){p.error("图片大小不能超过10MB");return}const l=new FileReader;l.onload=c=>{const u={file:o.raw,preview:c.target.result,name:o.name,size:o.raw.size,uploading:!1,uploaded:!1,error:!1,progress:0,imageId:null,savePath:null};r.value.push(u)},l.readAsDataURL(o.raw)}function V(o,e){const n=r.value.findIndex(f=>f.name===o.name);n!==-1&&r.value.splice(n,1)}function W(o){r.value.splice(o,1)}function F(){p.warning("最多只能上传10张图片")}function M(o){return!1}function R(){T.back()}function J(){T.push("/tools/image-translate/list")}async function K(){if(!i.value.sourceLanguage){p.error("请选择源语言");return}if(!i.value.targetLanguage){p.error("请选择目标语言");return}const o=i.value.sourceLanguage==="zh"||i.value.sourceLanguage==="en",e=i.value.targetLanguage==="zh"||i.value.targetLanguage==="en";if(!o&&!e){p.error("源语言和目标语言必须至少有一种是中文或英文");return}h.value=!0,k.value="";try{const n=r.value.map(async(l,c)=>{if(l.uploaded&&l.savePath)return{index:c,success:!0,savePath:l.savePath};l.uploading=!0,l.progress=0,l.error=!1;try{const u=new FormData;u.append("file",l.file);const _=await ce(u);if(_.code===200)return l.uploaded=!0,l.uploading=!1,l.savePath=_.data.save_path,l.imageId=_.data.id||null,{index:c,success:!0,savePath:_.data.save_path};throw new Error(_.message||"上传失败")}catch(u){return l.uploading=!1,l.error=!0,console.error(`图片 ${l.name} 上传失败:`,u),{index:c,success:!1,error:u.message||"上传失败"}}}),b=(await Promise.all(n)).filter(l=>!l.success);if(b.length>0){k.value=`${b.length}张图片上传失败，请重试`,h.value=!1;return}try{const l=r.value.filter(u=>u.uploaded&&u.imageId).map(u=>u.imageId);if(l.length===0){p.error("没有可提交的图片"),h.value=!1;return}const c=await de({image_ids:l,source_language:i.value.sourceLanguage,target_language:i.value.targetLanguage});if(c.code===200){const{success_count:u,failed_count:_,message:S}=c.data;_>0?p.warning(S||`${_}个翻译任务提交失败，请稍后查看任务列表`):p.success("翻译任务已提交，正在跳转到任务列表..."),setTimeout(()=>{T.push("/tools/image-translate/list")},500)}else p.error(c.message||"提交翻译任务失败，请重试")}catch(l){console.error("提交翻译任务失败:",l),p.error("提交翻译任务失败，请重试")}finally{h.value=!1}}catch(n){console.error("提交翻译失败:",n),k.value=n.message||"提交翻译失败，请重试",h.value=!1}}return(o,e)=>{const n=w("el-button"),f=w("el-icon"),b=w("el-upload"),l=w("el-progress"),c=w("el-option"),u=w("el-select"),_=w("el-form-item"),S=w("el-form"),Q=w("el-alert");return g(),v("div",ge,[a("div",pe,[a("div",ve,[a("div",fe,[t(n,{icon:m(ae),circle:"",onClick:R},null,8,["icon"]),e[2]||(e[2]=a("h2",null,"图片翻译",-1))]),a("div",_e,[t(n,{icon:m(le),onClick:J},{default:d(()=>e[3]||(e[3]=[L("查看任务列表",-1)])),_:1,__:[3]},8,["icon"])])]),a("div",me,[r.value.length===0?(g(),v("div",he,[t(b,{ref_key:"uploadRef",ref:A,class:"image-uploader",drag:"",action:$,accept:N,"auto-upload":!1,limit:10,multiple:"","on-change":U,"on-remove":V,"on-exceed":F,"before-upload":M,headers:{Authorization:"Bearer "+m(C).token}},{default:d(()=>[a("div",we,[a("div",Be,[t(f,{size:64,color:"#409EFF"},{default:d(()=>[t(m(se))]),_:1})]),e[4]||(e[4]=a("div",{class:"upload-text"},[a("p",{class:"upload-title"},"点击或拖拽图片到此处上传"),a("p",{class:"upload-tips"},"支持 JPG、PNG、WEBP、GIF 格式，最多10张，每张 ≤ 10MB")],-1))])]),_:1},8,["headers"])])):B("",!0),r.value.length>0?(g(),v("div",be,[a("div",ye,[a("div",ke,[a("div",ze,[e[5]||(e[5]=a("h3",null,"已上传图片",-1)),a("span",Le,z(r.value.length)+"/10",1)]),a("div",Te,[r.value.length<10?(g(),j(b,{key:0,ref_key:"compactUploadRef",ref:D,class:"compact-uploader",action:$,accept:N,"auto-upload":!1,limit:10,multiple:"","on-change":U,"on-remove":V,"on-exceed":F,"before-upload":M,headers:{Authorization:"Bearer "+m(C).token},"show-file-list":!1},{default:d(()=>[t(n,{type:"primary",size:"small",icon:m(te),plain:""},{default:d(()=>e[6]||(e[6]=[L("添加图片",-1)])),_:1,__:[6]},8,["icon"])]),_:1},8,["headers"])):B("",!0)])]),a("div",Se,[(g(!0),v(x,null,I(r.value,(s,E)=>(g(),v("div",{key:E,class:oe(["preview-item",{uploading:s.uploading,uploaded:s.uploaded,error:s.error}])},[a("div",xe,[a("img",{src:s.preview,class:"preview-thumb"},null,8,Ie),s.uploading?(g(),v("div",Ce,[t(l,{percentage:s.progress||0,status:s.error?"exception":void 0,width:50,type:"circle"},null,8,["percentage","status"])])):B("",!0),s.uploaded&&!s.uploading?(g(),v("div",Pe,[t(f,{size:24,color:"#fff"},{default:d(()=>[t(m(re))]),_:1})])):B("",!0),s.error?(g(),v("div",Ue,[t(f,{size:24,color:"#fff"},{default:d(()=>[t(m(ne))]),_:1})])):B("",!0),a("div",Ve,[t(n,{type:"danger",icon:m(ue),circle:"",size:"small",onClick:De=>W(E),disabled:s.uploading},null,8,["icon","onClick","disabled"])])]),a("div",Fe,[a("div",{class:"preview-name",title:s.name},z(s.name),9,Me),a("div",Re,z(Z(s.size)),1)])],2))),128))])]),a("div",Ee,[e[9]||(e[9]=a("div",{class:"section-header"},[a("h3",null,"翻译设置")],-1)),t(S,{model:i.value,"label-width":"90px","label-position":"top",class:"translate-form"},{default:d(()=>[t(_,{label:"源语言",required:""},{default:d(()=>[t(u,{modelValue:i.value.sourceLanguage,"onUpdate:modelValue":e[0]||(e[0]=s=>i.value.sourceLanguage=s),placeholder:"请选择源语言",size:"large",style:{width:"100%"}},{default:d(()=>[(g(),v(x,null,I(P,s=>t(c,{key:s.value,label:s.label,value:s.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),e[7]||(e[7]=a("div",{class:"form-tip"},"必须选择源语言",-1))]),_:1,__:[7]}),t(_,{label:"目标语言",required:""},{default:d(()=>[t(u,{modelValue:i.value.targetLanguage,"onUpdate:modelValue":e[1]||(e[1]=s=>i.value.targetLanguage=s),placeholder:"请选择目标语言",size:"large",style:{width:"100%"}},{default:d(()=>[(g(),v(x,null,I(q,s=>t(c,{key:s.value,label:s.label,value:s.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),e[8]||(e[8]=a("div",{class:"form-tip"},"至少有一个是中文或英文",-1))]),_:1,__:[8]})]),_:1},8,["model"])])])):B("",!0),k.value?(g(),v("div",je,[t(Q,{title:k.value,type:"error",closable:!1,"show-icon":""},null,8,["title"])])):B("",!0)]),r.value.length>0?(g(),v("div",Ne,[t(n,{onClick:R,size:"large"},{default:d(()=>e[10]||(e[10]=[L("取消",-1)])),_:1,__:[10]}),t(n,{type:"primary",onClick:K,loading:h.value,disabled:r.value.length===0||!i.value.sourceLanguage||!i.value.targetLanguage||O.value||h.value,size:"large"},{default:d(()=>[h.value?B("",!0):(g(),j(f,{key:0,style:{"margin-right":"4px"}},{default:d(()=>[t(m(ie))]),_:1})),L(" "+z(h.value?"提交中...":`提交翻译（${r.value.length}张）`),1)]),_:1},8,["loading","disabled"])])):B("",!0)])])}}},Oe=X($e,[["__scopeId","data-v-60b07880"]]);export{Oe as default};
