import{_ as X,z as ee,u as le,r as v,i as r,o as _,c as h,a as l,k as o,l as m,w as n,T as ae,S as B,t as w,Y as te,m as k,Z as oe,x,n as se,a2 as R,F as ne,q as ie,a4 as re,E as d}from"./index-CAnwEIGi.js";import{p as de}from"./tools-t5wMzLZS.js";const ce={class:"pdf-to-image-page"},ue={class:"page-container"},pe={class:"page-header"},me={class:"header-left"},ve={class:"main-content"},_e={class:"left-panel"},fe={class:"upload-area"},ge={key:0,class:"file-info"},he={class:"file-name"},we={class:"file-size"},be={class:"action-buttons"},ke={class:"right-panel"},ye={class:"card-header"},Fe={key:0,class:"empty-result"},Pe={key:1,class:"converting-result"},Ce={key:2,class:"result-content"},De={class:"result-info"},Ie={class:"info-item"},ze={class:"value"},Ve={class:"info-item"},Be={class:"value"},xe={class:"info-item"},Re={class:"value"},Me={class:"images-grid"},Ue={class:"image-wrapper"},Ee=["src","alt","onClick"],Le={class:"image-overlay"},Ze={class:"image-name"},Se={class:"preview-content"},Te=["src"],Ne="/api/tools/pdf-to-image",$e={__name:"index",setup(je){const M=ee(),U=le(),b=v(null),p=v(null),f=v(!1),g=v(0),s=v(null),F=v(!1),I=v(""),c=v({imageFormat:"png",dpi:200,pageRange:""});function E(){M.back()}function L(t){p.value=t.raw}function Z(){p.value=null,s.value=null}function S(){p.value=null,s.value=null,b.value&&b.value.clearFiles()}function T(t){const e=t.type==="application/pdf"||t.name.toLowerCase().endsWith(".pdf"),a=t.size/1024/1024<100;return e?(a||d.error("文件大小不能超过 100MB!"),!1):(d.error("只能上传PDF格式的文件!"),!1)}function N(t){if(t===0)return"0 B";const e=1024,a=["B","KB","MB","GB"],u=Math.floor(Math.log(t)/Math.log(e));return Math.round(t/Math.pow(e,u)*100)/100+" "+a[u]}async function $(){if(!p.value){d.warning("请先上传PDF文件");return}f.value=!0,g.value=0,s.value=null;const t=setInterval(()=>{g.value<90&&(g.value+=10)},500);try{const e=new FormData;e.append("file",p.value),e.append("image_format",c.value.imageFormat),e.append("dpi",c.value.dpi.toString()),c.value.pageRange&&e.append("page_range",c.value.pageRange);const a=await de(e);clearInterval(t),g.value=100,a.code===200?(s.value=a.data,d.success(a.data.message||"转换成功"),p.value=null,b.value&&b.value.clearFiles()):d.error(a.message||"转换失败")}catch(e){clearInterval(t),console.error("PDF转换失败:",e),d.error("转换失败，请稍后重试")}finally{f.value=!1,setTimeout(()=>{g.value=0},1e3)}}function z(t){I.value=t,F.value=!0}function j(t,e){try{const a=document.createElement("a");a.href=t,a.download=e||"image.png",a.target="_blank",fetch(t).then(u=>u.blob()).then(u=>{const y=window.URL.createObjectURL(u);a.href=y,document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(y),d.success("图片下载成功")}).catch(u=>{console.error("下载图片失败:",u),a.href=t,document.body.appendChild(a),a.click(),document.body.removeChild(a),d.warning("图片下载中，如未自动下载请右键保存")})}catch(a){console.error("下载图片失败:",a),d.error("下载图片失败")}}function G(){if(!s.value||!s.value.zip_url){d.warning("ZIP文件不存在");return}try{const t=document.createElement("a");t.href=s.value.zip_url,t.download=`pdf_images_${new Date().getTime()}.zip`,t.target="_blank",document.body.appendChild(t),t.click(),document.body.removeChild(t),d.success("ZIP文件下载中...")}catch(t){console.error("下载ZIP失败:",t),d.error("下载ZIP失败")}}return(t,e)=>{const a=r("el-button"),u=r("el-icon"),y=r("el-upload"),P=r("el-card"),C=r("el-option"),O=r("el-select"),D=r("el-form-item"),W=r("el-slider"),q=r("el-input"),A=r("el-form"),J=r("el-empty"),K=r("el-progress"),Y=r("el-alert"),H=r("el-dialog");return _(),h("div",ce,[l("div",ue,[l("div",pe,[l("div",me,[o(a,{icon:m(ae),circle:"",onClick:E},null,8,["icon"]),e[4]||(e[4]=l("h2",null,"PDF转图片",-1))])]),l("div",ve,[l("div",_e,[o(P,{class:"upload-card"},{header:n(()=>e[5]||(e[5]=[l("div",{class:"card-header"},[l("span",null,"上传PDF文件")],-1)])),default:n(()=>[o(y,{ref_key:"uploadRef",ref:b,class:"pdf-uploader",drag:"",action:Ne,"auto-upload":!1,limit:1,"on-change":L,"on-remove":Z,"before-upload":T,accept:"application/pdf,.pdf",headers:{Authorization:"Bearer "+m(U).token}},{default:n(()=>[l("div",fe,[o(u,{size:64,color:"#409EFF"},{default:n(()=>[o(m(B))]),_:1}),e[6]||(e[6]=l("div",{class:"upload-text"},[l("p",{class:"upload-title"},"点击或拖拽PDF文件到此处上传"),l("p",{class:"upload-tips"},"支持PDF格式，文件大小 ≤ 100MB")],-1))])]),_:1},8,["headers"]),p.value?(_(),h("div",ge,[o(u,null,{default:n(()=>[o(m(B))]),_:1}),l("span",he,w(p.value.name),1),l("span",we,w(N(p.value.size)),1),o(a,{type:"danger",icon:m(te),size:"small",circle:"",onClick:S},null,8,["icon"])])):k("",!0)]),_:1}),o(P,{class:"settings-card"},{header:n(()=>e[7]||(e[7]=[l("div",{class:"card-header"},[l("span",null,"转换设置")],-1)])),default:n(()=>[o(A,{model:c.value,"label-width":"120px","label-position":"left"},{default:n(()=>[o(D,{label:"图片格式"},{default:n(()=>[o(O,{modelValue:c.value.imageFormat,"onUpdate:modelValue":e[0]||(e[0]=i=>c.value.imageFormat=i),placeholder:"请选择图片格式",style:{width:"100%"}},{default:n(()=>[o(C,{label:"PNG（推荐，支持透明背景）",value:"png"}),o(C,{label:"JPG（文件更小）",value:"jpg"}),o(C,{label:"WEBP（现代格式，文件最小）",value:"webp"})]),_:1},8,["modelValue"])]),_:1}),o(D,{label:"分辨率 (DPI)"},{default:n(()=>[o(W,{modelValue:c.value.dpi,"onUpdate:modelValue":e[1]||(e[1]=i=>c.value.dpi=i),min:72,max:600,step:10,"show-input":"","show-input-controls":!1},null,8,["modelValue"]),e[8]||(e[8]=l("div",{class:"dpi-tips"},[l("span",{class:"tip-item"},"72 DPI - 网页显示"),l("span",{class:"tip-item"},"200 DPI - 标准打印（推荐）"),l("span",{class:"tip-item"},"300 DPI - 高质量打印"),l("span",{class:"tip-item"},"600 DPI - 超高质量")],-1))]),_:1,__:[8]}),o(D,{label:"页面范围"},{default:n(()=>[o(q,{modelValue:c.value.pageRange,"onUpdate:modelValue":e[2]||(e[2]=i=>c.value.pageRange=i),placeholder:"留空转换所有页面，例如: 1-5 或 1",clearable:""},null,8,["modelValue"]),e[9]||(e[9]=l("div",{class:"page-range-tips"},[l("span",null,"留空：转换所有页面"),l("span",null,"示例：1-5（转换第1到第5页）"),l("span",null,"示例：1（只转换第1页）")],-1))]),_:1,__:[9]})]),_:1},8,["model"]),l("div",be,[o(a,{type:"primary",size:"large",icon:m(oe),onClick:$,loading:f.value,disabled:!p.value,style:{width:"100%"}},{default:n(()=>[x(w(f.value?"转换中...":"开始转换"),1)]),_:1},8,["icon","loading","disabled"])])]),_:1})]),l("div",ke,[o(P,{class:"result-card"},{header:n(()=>[l("div",ye,[e[11]||(e[11]=l("span",null,"转换结果",-1)),s.value&&s.value.images&&s.value.images.length>1?(_(),se(a,{key:0,type:"primary",size:"small",icon:m(R),onClick:G},{default:n(()=>e[10]||(e[10]=[x(" 下载全部 (ZIP) ",-1)])),_:1,__:[10]},8,["icon"])):k("",!0)])]),default:n(()=>[!s.value&&!f.value?(_(),h("div",Fe,[o(J,{description:"上传PDF文件并点击转换按钮开始转换"})])):k("",!0),f.value?(_(),h("div",Pe,[o(K,{percentage:g.value,status:g.value===100?"success":null,"stroke-width":8},null,8,["percentage","status"]),e[12]||(e[12]=l("p",{class:"converting-text"},"正在转换PDF，请稍候...",-1))])):k("",!0),s.value&&!f.value?(_(),h("div",Ce,[o(Y,{title:s.value.message,type:"success",closable:!1,"show-icon":"",style:{"margin-bottom":"20px"}},null,8,["title"]),l("div",De,[l("div",Ie,[e[13]||(e[13]=l("span",{class:"label"},"总页数：",-1)),l("span",ze,w(s.value.total_pages),1)]),l("div",Ve,[e[14]||(e[14]=l("span",{class:"label"},"图片格式：",-1)),l("span",Be,w(s.value.image_format),1)]),l("div",xe,[e[15]||(e[15]=l("span",{class:"label"},"分辨率：",-1)),l("span",Re,w(s.value.dpi)+" DPI",1)])]),l("div",Me,[(_(!0),h(ne,null,ie(s.value.images,(i,Q)=>(_(),h("div",{key:Q,class:"image-item"},[l("div",Ue,[l("img",{src:i.url,alt:i.filename,onClick:V=>z(i.url)},null,8,Ee),l("div",Le,[o(a,{type:"primary",icon:m(re),circle:"",size:"small",onClick:V=>z(i.url),title:"预览"},null,8,["icon","onClick"]),o(a,{type:"success",icon:m(R),circle:"",size:"small",onClick:V=>j(i.url,i.filename),title:"下载"},null,8,["icon","onClick"])])]),l("div",Ze,w(i.filename),1)]))),128))])])):k("",!0)]),_:1})])])]),o(H,{modelValue:F.value,"onUpdate:modelValue":e[3]||(e[3]=i=>F.value=i),title:"图片预览",width:"90%","close-on-click-modal":!0,"align-center":"",class:"image-preview-dialog"},{default:n(()=>[l("div",Se,[l("img",{src:I.value,alt:"预览图片",class:"preview-full-image"},null,8,Te)])]),_:1},8,["modelValue"])])}}},We=X($e,[["__scopeId","data-v-b83ecef2"]]);export{We as default};
