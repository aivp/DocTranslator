import{X as D,_ as Ue,u as Be,r as y,Y as Ce,e as Ee,f as De,h as Re,i as F,j as je,o as d,c as f,a as n,k as s,w as r,t as m,m as w,p as qe,n as x,E as g,z as _e,C as h,D as Ae,F as R,q as j}from"./index-BGzn8DMf.js";import{a as Ie}from"./tools-B1vwaomo.js";const q={uploadVideo:b=>D({url:"/video/upload",method:"post",data:b,headers:{"Content-Type":"multipart/form-data"}}),startTranslate:b=>D({url:"/video/translate",method:"post",data:b,headers:{"Content-Type":"application/json"}}),getVideoStatus:b=>D({url:`/video/status/${b}`,method:"get"}),getVideoList:b=>D({url:"/video/list",method:"get",params:b}),deleteVideo:b=>D({url:`/video/${b}`,method:"delete"}),downloadVideo:b=>D({url:`/video/${b}/download`,method:"get",responseType:"blob"}),getLanguages:()=>D({url:"/video/languages",method:"get"}),getVoices:b=>D({url:"/video/voices",method:"get",params:b})},Ne={name:"VideoTranslate",setup(){const b=Be(),o=y(),k=y([]),a=y(!1),H=y(!1),O=y(!1),A=y([]),V=y([]),_=y(""),T=y(1),S=y(10),K=y(0),W=y(!1),G=y(),L=y([]),J=y(null),I=y(!1),B=y({}),M=y({}),N=y({}),C=y([]),l="/api/video/upload",U=".mp4,.avi,.mov,.wmv,.flv,.mkv,.webm",u=Ce({video_ids:[],source_language:"auto",target_languages:[],speaker_num:0,lipsync_enabled:!1,lip_sync_type:0,voices_map:{},terminology_ids:[],style:"professional",caption_type:0,dynamic_duration:!1}),z=[{value:"affectionate",label:"深情 (Affectionate)"},{value:"angry",label:"愤怒 (Angry)"},{value:"calm",label:"平静 (Calm)"},{value:"cheerful",label:"愉快 (Cheerful)"},{value:"depressed",label:"沮丧 (Depressed)"},{value:"disgruntled",label:"不满 (Disgruntled)"},{value:"embarrassed",label:"尴尬 (Embarrassed)"},{value:"empathetic",label:"共情 (Empathetic)"},{value:"excited",label:"兴奋 (Excited)"},{value:"fearful",label:"恐惧 (Fearful)"},{value:"friendly",label:"友好 (Friendly)"},{value:"unfriendly",label:"不友好 (Unfriendly)"},{value:"sad",label:"悲伤 (Sad)"},{value:"serious",label:"严肃 (Serious)"},{value:"relaxed",label:"放松 (Relaxed)"},{value:"professional",label:"专业 (Professional)"}],Q={source_language:[{required:!0,message:"请选择源语言",trigger:"change"}],target_languages:[{required:!0,message:"请选择目标语言",trigger:"change"},{type:"array",min:1,message:"至少选择一个目标语言",trigger:"change"}]};Ee(()=>currentVideo.value&&u.source_language&&u.target_languages.length>0&&!O.value);const Z=e=>{const t=e.type.startsWith("video/"),c=e.size/1024/1024<300;return t?c?!0:(g.error("视频文件大小不能超过 300MB!"),!1):(g.error("只能上传视频文件!"),!1)},$=(e,t)=>{e.code===200?(k.value.push({id:e.data.id,name:e.data.original_filename||e.data.filename,url:e.data.video_url,size:e.data.file_size}),g.success(`视频上传成功! (${k.value.length}/5)`),E()):g.error(e.message||"上传失败")},ee=e=>{console.error("Upload error:",e),g.error("上传失败，请重试")},ae=()=>{g.warning("最多只能上传5个视频文件")},i=(e,t)=>{a.value=t.length>0},me=()=>(k.value=[],le(),!0),le=()=>{Object.assign(u,{video_ids:[],source_language:"auto",target_languages:[],speaker_num:0,lipsync_enabled:!1,lip_sync_type:0,voices_map:{},terminology_ids:[],style:"professional",caption_type:0,dynamic_duration:!1}),J.value=null,L.value=[],I.value=!1,B.value={},M.value={},N.value={}},re=()=>{if(!k.value||k.value.length===0){g.warning("请先上传视频");return}le(),u.video_ids=k.value.map(e=>e.id),ne(),W.value=!0},ie=e=>{if(!e)return"0 B";const t=1024,c=["B","KB","MB","GB"],v=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,v)).toFixed(2))+" "+c[v]},fe=()=>{if(!k.value||k.value.length===0)return"0 B";const e=k.value.reduce((t,c)=>t+(c.size||0),0);return ie(e)},ve=async()=>{if(G.value){try{await G.value.validate()}catch{return}if(!k.value||k.value.length===0){g.error("请先上传视频");return}if(!u.target_languages||u.target_languages.length===0){g.error("请选择目标语言");return}O.value=!0;try{const e=u.video_ids,t=e.length*u.target_languages.length;g.info(`开始批量翻译 ${e.length} 个视频，共 ${t} 个任务...`);let c=0,v=0;for(let p=0;p<e.length;p++){const se=e[p];try{const X={video_id:se,source_language:u.source_language,target_languages:u.target_languages,speaker_num:u.speaker_num,lipsync_enabled:u.lipsync_enabled,lip_sync_type:u.lip_sync_type,voices_map:B.value,terminology_ids:u.terminology_ids,style:u.style,caption_type:u.caption_type,dynamic_duration:u.dynamic_duration},Y=await q.startTranslate(X);if(Y.code===200)c++,console.log(`视频 ${p+1}/${e.length} 翻译任务已启动`);else{v++;const ge=Y.message||Y.msg||"未知错误";console.error(`视频 ${p+1}/${e.length} 翻译失败:`,ge),g.error(`视频 ${p+1} 翻译失败: ${ge}`)}}catch(X){v++;const Y=X.message||X.toString()||"网络错误";console.error(`视频 ${p+1}/${e.length} 翻译异常:`,X),g.error(`视频 ${p+1} 翻译异常: ${Y}`)}}c>0?g.success(`批量翻译已启动! 成功: ${c} 个视频，失败: ${v} 个`):g.error(`批量翻译全部失败，共尝试 ${e.length} 个视频`),W.value=!1,E(),le(),k.value=[],o.value.clearFiles(),setTimeout(()=>{oe()},1e3)}catch(e){console.error("Batch translate error:",e),g.error("批量翻译失败，请重试")}finally{O.value=!1}}},E=async()=>{H.value=!0;try{const e={page:T.value,per_page:S.value};_.value&&(e.status=_.value);const t=await q.getVideoList(e);t.code===200?(A.value=t.data.videos,K.value=t.data.total,A.value.filter(v=>v.status==="processing"||v.status==="queued").length>0?oe():te()):g.error(t.message||"获取视频列表失败")}catch(e){console.error("Load video list error:",e),g.error("获取视频列表失败")}finally{H.value=!1}},de=async()=>{try{const e=await q.getLanguages();e.code===200?V.value=e.data.languages:V.value=[{lang_code:"en",lang_name:"English"},{lang_code:"zh",lang_name:"Chinese (Simplified)"},{lang_code:"fr",lang_name:"French"},{lang_code:"de",lang_name:"German"},{lang_code:"ja",lang_name:"Japanese"},{lang_code:"ko",lang_name:"Korean"},{lang_code:"es",lang_name:"Spanish"},{lang_code:"ru",lang_name:"Russian"}]}catch(e){console.error("Load languages error:",e),V.value=[{lang_code:"en",lang_name:"English"},{lang_code:"zh",lang_name:"Chinese (Simplified)"},{lang_code:"fr",lang_name:"French"},{lang_code:"de",lang_name:"German"},{lang_code:"ja",lang_name:"Japanese"},{lang_code:"ko",lang_name:"Korean"},{lang_code:"es",lang_name:"Spanish"},{lang_code:"ru",lang_name:"Russian"}]}},ce=async e=>{try{if(M.value[e])return M.value[e];N.value[e]=!0;const t={page:1,size:100};e&&(t.language_code=e);const c=await q.getVoices(t);if(c.code===200){const v=c.data.result||[];return M.value[e]=v,v}else return M.value[e]=[],[]}catch(t){return console.error("Load voices error:",t),M.value[e]=[],[]}finally{N.value[e]=!1}},pe=async e=>{const t=Object.keys(B.value);t.filter(p=>!e.includes(p)).forEach(p=>{delete B.value[p]});const v=e.filter(p=>!t.includes(p));for(const p of v)await ce(p)},ye=(e,t)=>{t?B.value[e]=t:delete B.value[e]},he=e=>M.value[e]||[],ne=async()=>{try{console.log("开始加载术语库...");const e=await D({url:"/comparison/my",method:"get"});console.log("术语库API响应:",e),e.code===200?(C.value=e.data.data||e.data.comparisons||[],console.log("加载术语库成功:",C.value.length,"个术语库"),console.log("术语库详情:",C.value)):(console.error("加载术语库失败:",e.message),C.value=[])}catch(e){console.error("加载术语库异常:",e),C.value=[]}},be=e=>{e&&C.value.length===0&&ne()},Ve=e=>{e.translated_video_url?window.open(e.translated_video_url,"_blank"):g.warning("翻译视频不存在")},we=async e=>{if(e.translated_video_url)try{e.downloading=!0,g.info("正在准备下载...");const t=await q.downloadVideo(e.id);if(t instanceof Blob){const c=window.URL.createObjectURL(t),v=document.createElement("a");v.href=c;const p=e.original_filename||e.filename||"translated_video.mp4",se=p.endsWith(".mp4")?p:`${p}.mp4`;v.download=se,document.body.appendChild(v),v.click(),document.body.removeChild(v),window.URL.revokeObjectURL(c),g.success("视频下载已开始")}else throw new Error("下载响应格式错误")}catch(t){console.error("下载失败:",t),g.error("下载失败，请重试")}finally{e.downloading=!1}else g.warning("翻译视频不存在")},ke=async e=>{try{await _e.confirm("确定要重新生成这个视频吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const t={video_id:e.id,source_language:e.source_language,target_language:e.target_language,lipsync_enabled:e.lipsync_enabled,speaker_num:0},c=await q.startTranslate(t);c.code===200?(g.success("重新生成任务已启动!"),E()):g.error(c.message||"重新生成失败")}catch(t){t!=="cancel"&&(console.error("Renew video error:",t),g.error("重新生成失败"))}},Fe=e=>{k.value=[{id:e.id,name:e.original_filename||e.filename,url:e.video_url,size:e.file_size}],u.video_ids=[e.id],u.source_language=e.source_language,u.target_languages=e.target_language?[e.target_language]:[],u.lipsync_enabled=e.lipsync_enabled,u.speaker_num=0,re()},xe=async e=>{try{await _e.confirm("确定要删除这个视频吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const t=await q.deleteVideo(e.id);t.code===200?(g.success("删除成功!"),E()):g.error(t.message||"删除失败")}catch(t){t!=="cancel"&&(console.error("Delete video error:",t),g.error("删除失败"))}},ue=async e=>{if(!e.akool_task_id){g.warning("无法获取任务状态，缺少任务ID");return}try{e.refreshing=!0;const t=await q.getVideoStatus(e.id);if(t.code===200){const c=t.data;Object.assign(e,c),g.success("状态已更新"),(c.status==="completed"||c.status==="failed")&&E()}else g.error("获取状态失败")}catch(t){console.error("刷新状态失败:",t),g.error("刷新状态失败")}finally{e.refreshing=!1}},Le=e=>{T.value=e,E()},ze=e=>{const t=V.value.find(c=>c.lang_code===e);return t?t.lang_name:e},Te=e=>({uploaded:"info",queued:"warning",processing:"warning",completed:"success",failed:"danger",expired:"info"})[e]||"info",Se=e=>({uploaded:"已上传",queued:"队列中",processing:"处理中",completed:"已完成",failed:"已失败",expired:"已过期"})[e]||e,Me=e=>({completed:"status-completed",expired:"status-expired",queued:"status-queued",processing:"status-processing",failed:"status-failed"})[e]||"";let P=null;const oe=()=>{P&&clearInterval(P);const e=A.value.filter(t=>t.status==="processing");e.length>0&&(console.log(`发现 ${e.length} 个处理中的视频，启动自动刷新`),P=setInterval(async()=>{try{for(const c of e)c.status==="processing"&&c.akool_task_id&&(console.log(`自动刷新视频 ${c.id} 状态`),await ue(c));await E(),A.value.filter(c=>c.status==="processing").length===0&&(console.log("所有视频处理完成，停止自动刷新"),te())}catch(t){console.error("自动刷新失败:",t)}},2e4))},te=()=>{P&&(clearInterval(P),P=null,console.log("自动刷新已停止"))};return De(()=>{de(),E(),setTimeout(()=>{oe()},2e3)}),Re(()=>{te()}),{uploadRef:o,currentVideos:k,fileListShow:a,loading:H,isTranslating:O,videoList:A,languages:V,statusFilter:_,currentPage:T,pageSize:S,total:K,upload_url:l,video_accepts:U,translateForm:u,translateRules:Q,translateFormRef:G,translateDialogVisible:W,availableVoices:L,selectedVoice:J,showVoiceSelection:I,voiceMap:B,languageVoices:M,languageVoicesLoading:N,terminologies:C,styleOptions:z,beforeUpload:Z,uploadSuccess:$,uploadError:ee,handleExceed:ae,handleFileChange:i,delUploadFile:me,resetForm:le,openTranslateDialog:re,startTranslate:ve,loadVideoList:E,loadLanguages:de,loadVoices:ce,handleTargetLanguagesChange:pe,handleVoiceChangeForLanguage:ye,getVoicesForLanguage:he,loadTerminologies:ne,handleTerminologyVisible:be,previewVideo:Ve,downloadVideo:we,renewVideo:ke,editVideo:Fe,deleteVideo:xe,refreshVideoStatus:ue,startAutoRefresh:oe,stopAutoRefresh:te,handlePageChange:Le,getLanguageName:ze,getStatusType:Te,getStatusText:Se,getStatusClass:Me,formatFileSize:ie,getTotalVideoSize:fe,formatDate:Ie,userStore:b}}},Pe={class:"page-center"},Oe={class:"container"},Ke={class:"upload-container"},We={class:"left_box pc_show"},Ge={key:0,class:"icon_box"},Je={class:"right_box"},Xe={key:0,class:"file-count-tip success"},Ye={key:0,class:"generate-container"},He={class:"video-preview"},Qe={class:"video-frame"},Ze={class:"video-info"},$e={class:"video-name"},ea={class:"video-size"},aa={class:"action-buttons"},la={class:"list_box"},oa={class:"title_box"},ta={class:"filter-box"},na={class:"filename-cell"},sa={class:"status-info"},ra={key:0,class:"expiry-warning"},ia={class:"pagination-box"},da={class:"voice-selection-container"},ca={class:"voice-selection-label"},ua={class:"voice-loading-empty"},ga={key:0,class:"el-icon-loading"},_a={key:1},ma={key:2},fa={class:"voice-option"},va={class:"voice-info"},pa={class:"voice-name"},ya={class:"voice-gender"},ha={class:"voice-details"},ba={class:"voice-language"},Va={key:0,class:"voice-style"},wa={key:0,class:"voice-preview"},ka={class:"voice-preview-info"},Fa=["src"],xa={class:"voice-details"},La={class:"voice-tags"},za={key:0,class:"voice-preview-audio"},Ta=["src"],Sa={class:"terminology-option"},Ma={class:"terminology-title"},Ua={class:"terminology-count"},Ba={class:"form-tip",style:{color:"#909399","font-size":"12px"}},Ca={class:"dialog-footer"};function Ea(b,o,k,a,H,O){const A=F("el-upload"),V=F("el-button"),_=F("el-option"),T=F("el-select"),S=F("el-table-column"),K=F("el-tag"),W=F("el-table"),G=F("el-pagination"),L=F("el-form-item"),J=F("el-switch"),I=F("el-radio"),B=F("el-radio-group"),M=F("el-form"),N=F("el-dialog"),C=je("loading");return d(),f("div",Pe,[n("div",Oe,[n("div",Ke,[s(A,{ref:"uploadRef",class:"dropzone",drag:"",action:a.upload_url,accept:a.video_accepts,"auto-upload":"",limit:5,multiple:"","on-success":a.uploadSuccess,"on-error":a.uploadError,"on-exceed":a.handleExceed,headers:{Authorization:"Bearer "+a.userStore.token},"before-upload":a.beforeUpload,"before-remove":a.delUploadFile,"on-change":a.handleFileChange},{default:r(()=>[n("div",We,[a.fileListShow?w("",!0):(d(),f("div",Ge,o[12]||(o[12]=[n("i",{class:"el-icon-video-camera",style:{"font-size":"48px",color:"#409EFF"}},null,-1)])))]),n("div",Je,[o[13]||(o[13]=n("div",{class:"title pc_show"},"拖入/点击按钮选择视频文件（最多5个）",-1)),o[14]||(o[14]=n("button",{class:"upload_btn",type:"button"},[n("i",{class:"el-icon-upload",style:{"margin-right":"8px"}}),n("span",null,"上传视频")],-1)),o[15]||(o[15]=n("div",{class:"title phone_show"},"点击按钮选择视频文件（最多5个）",-1)),o[16]||(o[16]=n("div",{class:"tips"},"支持格式：MP4、AVI、MOV、WMV、FLV、MKV、WEBM，建议文件≤300MB",-1)),a.currentVideos&&a.currentVideos.length>0?(d(),f("div",Xe," 已选择："+m(a.currentVideos.length)+"个视频 ",1)):w("",!0)])]),_:1},8,["action","accept","on-success","on-error","on-exceed","headers","before-upload","before-remove","on-change"])]),a.currentVideos&&a.currentVideos.length>0?(d(),f("div",Ye,[n("div",He,[n("div",Qe,[o[17]||(o[17]=n("i",{class:"el-icon-video-camera",style:{"font-size":"48px",color:"#409EFF"}},null,-1)),n("div",Ze,[n("div",$e,"已选择 "+m(a.currentVideos.length)+" 个视频",1),n("div",ea,m(a.getTotalVideoSize()),1)])]),n("div",aa,[s(V,{type:"primary",size:"large",class:"generate-btn",onClick:a.openTranslateDialog},{default:r(()=>o[18]||(o[18]=[n("i",{class:"el-icon-magic-stick",style:{"margin-right":"8px"}},null,-1),h(" 批量生成翻译 > ",-1)])),_:1,__:[18]},8,["onClick"])])])])):w("",!0),n("div",la,[n("div",oa,[o[20]||(o[20]=n("h3",null,"视频翻译记录",-1)),n("div",ta,[s(T,{modelValue:a.statusFilter,"onUpdate:modelValue":o[0]||(o[0]=l=>a.statusFilter=l),placeholder:"筛选状态",onChange:a.loadVideoList,style:{width:"150px"}},{default:r(()=>[s(_,{label:"全部",value:""}),s(_,{label:"已上传",value:"uploaded"}),s(_,{label:"队列中",value:"queued"}),s(_,{label:"处理中",value:"processing"}),s(_,{label:"已完成",value:"completed"}),s(_,{label:"已失败",value:"failed"}),s(_,{label:"已过期",value:"expired"})]),_:1},8,["modelValue","onChange"]),s(V,{type:"primary",onClick:a.loadVideoList,loading:a.loading},{default:r(()=>o[19]||(o[19]=[n("i",{class:"el-icon-refresh"},null,-1),h(" 刷新 ",-1)])),_:1,__:[19]},8,["onClick","loading"])])]),qe((d(),x(W,{data:a.videoList,class:"video-table"},{default:r(()=>[s(S,{prop:"original_filename",label:"文件名","min-width":"250"},{default:r(l=>[n("div",na,[o[21]||(o[21]=n("i",{class:"el-icon-video-camera",style:{"margin-right":"8px",color:"#409EFF"}},null,-1)),h(" "+m(l.row.original_filename||l.row.filename),1)])]),_:1}),s(S,{prop:"source_language",label:"源语言",width:"120"},{default:r(l=>[h(m(a.getLanguageName(l.row.source_language)),1)]),_:1}),s(S,{prop:"target_language",label:"目标语言",width:"180"},{default:r(l=>[h(m(a.getLanguageName(l.row.target_language)),1)]),_:1}),s(S,{prop:"status",label:"状态",width:"120"},{default:r(l=>[s(K,{type:a.getStatusType(l.row.status)},{default:r(()=>[h(m(a.getStatusText(l.row.status)),1)]),_:2},1032,["type"])]),_:1}),s(S,{prop:"status_info",label:"状态信息","min-width":"250"},{default:r(l=>{var U,u,z;return[n("div",sa,[n("span",{class:Ae(a.getStatusClass((U=l.row.status_info)==null?void 0:U.status))},m((u=l.row.status_info)==null?void 0:u.message),3),(z=l.row.status_info)!=null&&z.days_left?(d(),f("span",ra," ⏰ "+m(l.row.status_info.days_left)+"天后过期 ",1)):w("",!0)])]}),_:1}),s(S,{prop:"file_size",label:"文件大小",width:"120"},{default:r(l=>[h(m(a.formatFileSize(l.row.file_size)),1)]),_:1}),s(S,{prop:"created_at",label:"创建时间",width:"180"},{default:r(l=>[h(m(a.formatDate(l.row.created_at)),1)]),_:1}),s(S,{label:"操作",width:"280",fixed:"right"},{default:r(l=>{var U,u;return[(U=l.row.status_info)!=null&&U.can_download?(d(),x(V,{key:0,type:"success",size:"mini",onClick:z=>a.previewVideo(l.row)},{default:r(()=>o[22]||(o[22]=[h(" 预览 ",-1)])),_:2,__:[22]},1032,["onClick"])):w("",!0),(u=l.row.status_info)!=null&&u.can_download?(d(),x(V,{key:1,type:"primary",size:"mini",loading:l.row.downloading,onClick:z=>a.downloadVideo(l.row)},{default:r(()=>o[23]||(o[23]=[h(" 下载 ",-1)])),_:2,__:[23]},1032,["loading","onClick"])):w("",!0),l.row.status==="expired"?(d(),x(V,{key:2,type:"warning",size:"mini",onClick:z=>a.renewVideo(l.row)},{default:r(()=>o[24]||(o[24]=[h(" 重新生成 ",-1)])),_:2,__:[24]},1032,["onClick"])):w("",!0),l.row.status==="uploaded"?(d(),x(V,{key:3,type:"success",size:"mini",onClick:z=>a.editVideo(l.row)},{default:r(()=>o[25]||(o[25]=[h(" 编辑 ",-1)])),_:2,__:[25]},1032,["onClick"])):w("",!0),l.row.status==="processing"||l.row.status==="queued"?(d(),x(V,{key:4,type:"warning",size:"mini",loading:l.row.refreshing,onClick:z=>a.refreshVideoStatus(l.row)},{default:r(()=>o[26]||(o[26]=[h(" 刷新状态 ",-1)])),_:2,__:[26]},1032,["loading","onClick"])):w("",!0),s(V,{type:"danger",size:"mini",onClick:z=>a.deleteVideo(l.row)},{default:r(()=>o[27]||(o[27]=[h(" 删除 ",-1)])),_:2,__:[27]},1032,["onClick"])]}),_:1})]),_:1},8,["data"])),[[C,a.loading]]),n("div",ia,[s(G,{onCurrentChange:a.handlePageChange,"current-page":a.currentPage,"page-size":a.pageSize,total:a.total,layout:"total, prev, pager, next, jumper"},null,8,["onCurrentChange","current-page","page-size","total"])])])]),s(N,{title:"生成翻译",modelValue:a.translateDialogVisible,"onUpdate:modelValue":o[11]||(o[11]=l=>a.translateDialogVisible=l),width:"600px","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:r(()=>[n("div",Ca,[s(V,{onClick:o[10]||(o[10]=l=>a.translateDialogVisible=!1)},{default:r(()=>o[38]||(o[38]=[h("取消",-1)])),_:1,__:[38]}),s(V,{type:"primary",onClick:a.startTranslate,loading:a.isTranslating,disabled:a.isTranslating},{default:r(()=>o[39]||(o[39]=[h(" 翻译 ",-1)])),_:1,__:[39]},8,["onClick","loading","disabled"])])]),default:r(()=>[s(M,{model:a.translateForm,rules:a.translateRules,ref:"translateFormRef","label-width":"120px"},{default:r(()=>[s(L,{label:"源语言",prop:"source_language"},{default:r(()=>[s(T,{modelValue:a.translateForm.source_language,"onUpdate:modelValue":o[1]||(o[1]=l=>a.translateForm.source_language=l),placeholder:"请选择源语言",style:{width:"100%"}},{default:r(()=>[s(_,{label:"自动检测",value:"auto"}),(d(!0),f(R,null,j(a.languages,l=>(d(),x(_,{key:l.lang_code,label:l.lang_name,value:l.lang_code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),s(L,{label:"目标语言",prop:"target_languages"},{default:r(()=>[s(T,{modelValue:a.translateForm.target_languages,"onUpdate:modelValue":o[2]||(o[2]=l=>a.translateForm.target_languages=l),placeholder:"请选择目标语言（支持多选）",multiple:"","collapse-tags":"","collapse-tags-tooltip":"",style:{width:"100%"},onChange:a.handleTargetLanguagesChange},{default:r(()=>[(d(!0),f(R,null,j(a.languages,l=>(d(),x(_,{key:l.lang_code,label:l.lang_name,value:l.lang_code},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"]),o[28]||(o[28]=n("div",{class:"form-tip"},"支持同时选择多个目标语言进行翻译",-1))]),_:1,__:[28]}),a.translateForm.target_languages&&a.translateForm.target_languages.length>0?(d(),x(L,{key:0,label:"AI语音"},{default:r(()=>[n("div",da,[(d(!0),f(R,null,j(a.translateForm.target_languages,l=>{var U,u,z,Q,Z,$,ee,ae;return d(),f("div",{key:l,class:"voice-selection-item"},[n("div",ca,[n("span",null,m(a.getLanguageName(l)),1)]),s(T,{modelValue:a.voiceMap[l],"onUpdate:modelValue":i=>a.voiceMap[l]=i,placeholder:a.languageVoicesLoading[l]?"正在加载语音列表...":`请为 ${a.getLanguageName(l)} 选择AI语音（可选）`,clearable:"",loading:a.languageVoicesLoading[l],style:{width:"100%"},onChange:i=>a.handleVoiceChangeForLanguage(l,i)},{empty:r(()=>[n("div",ua,[a.languageVoicesLoading[l]?(d(),f("i",ga)):w("",!0),a.languageVoicesLoading[l]?(d(),f("span",_a,"正在加载语音列表...")):(d(),f("span",ma,"暂无可用语音"))])]),default:r(()=>[(d(!0),f(R,null,j(a.getVoicesForLanguage(l),i=>(d(),x(_,{key:i.voice_id,label:`${i.name} (${i.gender})`,value:i.voice_id},{default:r(()=>[n("div",fa,[n("div",va,[n("span",pa,m(i.name),1),n("span",ya,m(i.gender),1)]),n("div",ha,[n("span",ba,m(i.language),1),i.style&&i.style.length?(d(),f("span",Va,m(i.style.join(", ")),1)):w("",!0)])])]),_:2},1032,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","placeholder","loading","onChange"]),a.voiceMap[l]?(d(),f("div",wa,[n("div",ka,[(U=a.getVoicesForLanguage(l).find(i=>i.voice_id===a.voiceMap[l]))!=null&&U.thumbnailUrl?(d(),f("img",{key:0,src:(u=a.getVoicesForLanguage(l).find(i=>i.voice_id===a.voiceMap[l]))==null?void 0:u.thumbnailUrl,class:"voice-avatar"},null,8,Fa)):w("",!0),n("div",xa,[n("h4",null,m((z=a.getVoicesForLanguage(l).find(i=>i.voice_id===a.voiceMap[l]))==null?void 0:z.name),1),n("p",null,m((Q=a.getVoicesForLanguage(l).find(i=>i.voice_id===a.voiceMap[l]))==null?void 0:Q.language)+" • "+m((Z=a.getVoicesForLanguage(l).find(i=>i.voice_id===a.voiceMap[l]))==null?void 0:Z.gender),1),n("div",La,[(d(!0),f(R,null,j(($=a.getVoicesForLanguage(l).find(i=>i.voice_id===a.voiceMap[l]))==null?void 0:$.style,i=>(d(),x(K,{key:i,size:"small",style:{"margin-right":"4px"}},{default:r(()=>[h(m(i),1)]),_:2},1024))),128))])])]),(ee=a.getVoicesForLanguage(l).find(i=>i.voice_id===a.voiceMap[l]))!=null&&ee.preview?(d(),f("div",za,[n("audio",{controls:"",src:(ae=a.getVoicesForLanguage(l).find(i=>i.voice_id===a.voiceMap[l]))==null?void 0:ae.preview,class:"preview-audio"},null,8,Ta)])):w("",!0)])):w("",!0)])}),128))]),o[29]||(o[29]=n("div",{class:"form-tip"},"为每个目标语言单独选择AI语音，不选择则使用默认语音",-1))]),_:1,__:[29]})):w("",!0),s(L,{label:"Lip Sync"},{default:r(()=>[s(J,{modelValue:a.translateForm.lipsync_enabled,"onUpdate:modelValue":o[3]||(o[3]=l=>a.translateForm.lipsync_enabled=l),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"]),o[30]||(o[30]=n("i",{class:"el-icon-info",style:{"margin-left":"8px",color:"#909399"}},null,-1))]),_:1,__:[30]}),a.translateForm.lipsync_enabled?(d(),x(L,{key:1,label:"唇语同步类型"},{default:r(()=>[s(B,{modelValue:a.translateForm.lip_sync_type,"onUpdate:modelValue":o[4]||(o[4]=l=>a.translateForm.lip_sync_type=l)},{default:r(()=>[s(I,{label:0},{default:r(()=>o[31]||(o[31]=[h("标准",-1)])),_:1,__:[31]}),s(I,{label:1},{default:r(()=>o[32]||(o[32]=[h("增强",-1)])),_:1,__:[32]}),s(I,{label:2},{default:r(()=>o[33]||(o[33]=[h("专业",-1)])),_:1,__:[33]})]),_:1},8,["modelValue"])]),_:1})):w("",!0),s(L,{label:"术语库"},{default:r(()=>[s(T,{modelValue:a.translateForm.terminology_ids,"onUpdate:modelValue":o[5]||(o[5]=l=>a.translateForm.terminology_ids=l),placeholder:"请选择术语库（可选，可多选）",multiple:"",clearable:"",filterable:"",style:{width:"100%"},onFocus:a.loadTerminologies,onVisibleChange:a.handleTerminologyVisible},{default:r(()=>[(d(!0),f(R,null,j(a.terminologies,l=>(d(),x(_,{key:l.id,label:l.title,value:l.id},{default:r(()=>[n("div",Sa,[n("span",Ma,m(l.title),1),n("span",Ua,"("+m(l.term_count||0)+"条术语)",1)])]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue","onFocus","onVisibleChange"]),o[34]||(o[34]=n("div",{class:"form-tip"},"选择术语库可以提高翻译的专业性和准确性",-1)),n("div",Ba," 当前加载了 "+m(a.terminologies.length)+" 个术语库 ",1)]),_:1,__:[34]}),s(L,{label:"发言者人数"},{default:r(()=>[s(T,{modelValue:a.translateForm.speaker_num,"onUpdate:modelValue":o[6]||(o[6]=l=>a.translateForm.speaker_num=l),placeholder:"自动检测",style:{width:"100%"}},{default:r(()=>[s(_,{label:"自动检测",value:0}),(d(),f(R,null,j([1,2,3,4,5],l=>s(_,{key:l,label:`${l}人`,value:l},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),s(L,{label:"翻译风格"},{default:r(()=>[s(T,{modelValue:a.translateForm.style,"onUpdate:modelValue":o[7]||(o[7]=l=>a.translateForm.style=l),placeholder:"请选择翻译风格",style:{width:"100%"}},{default:r(()=>[(d(!0),f(R,null,j(a.styleOptions,l=>(d(),x(_,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o[35]||(o[35]=n("div",{class:"form-tip"},"选择翻译风格，影响语音的情感表达",-1))]),_:1,__:[35]}),s(L,{label:"字幕设置"},{default:r(()=>[s(T,{modelValue:a.translateForm.caption_type,"onUpdate:modelValue":o[8]||(o[8]=l=>a.translateForm.caption_type=l),placeholder:"请选择字幕类型",style:{width:"100%"}},{default:r(()=>[s(_,{label:"无字幕",value:0}),s(_,{label:"添加原始字幕",value:1}),s(_,{label:"添加目标字幕",value:2}),s(_,{label:"翻译并替换原始字幕",value:3}),s(_,{label:"添加翻译字幕",value:4})]),_:1},8,["modelValue"]),o[36]||(o[36]=n("div",{class:"form-tip"},"选择是否在视频中添加字幕，以及字幕的显示方式",-1))]),_:1,__:[36]}),s(L,{label:"动态时长"},{default:r(()=>[s(J,{modelValue:a.translateForm.dynamic_duration,"onUpdate:modelValue":o[9]||(o[9]=l=>a.translateForm.dynamic_duration=l),"active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"]),o[37]||(o[37]=n("div",{class:"form-tip"},"启用后可改善视频语速，自动调整视频时长以适应翻译后的语音节奏",-1))]),_:1,__:[37]})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}const ja=Ue(Ne,[["render",Ea],["__scopeId","data-v-11fc0e2e"]]);export{ja as default};
